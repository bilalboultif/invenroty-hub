<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">

<style>
     /* Filters Section */
     .filters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 10px;
        }

        .filters label {
            font-size: 16px;
            display: flex;
            align-items: center;
            color: #34495e;
            cursor: pointer;
            transition: color 0.3s;
        }

        .filters input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
            transition: transform 0.3s ease-in-out;
        }

        .filters label:hover {
            color: #3498db;
        }

        .filters input[type="checkbox"]:hover {
            transform: scale(1.3);
        }

        /* Search Bar Section */
        .search-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .search-bar input {
            padding: 10px 20px;
            font-size: 16px;
            width: 50%;
            max-width: 400px;
            border-radius: 5px;
            border: 1px solid #ccc;
            outline: none;
            transition: all 0.3s ease-in-out;
        }

        .search-bar input:focus {
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            font-size: 14px;
            color: #555;
        }

        th {
            background-color: #3498db;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        tr {
            transition: background-color 0.3s;
        }

        tr:nth-child(even) {
            background-color: #f4f4f4;
        }

        tr:hover {
            background-color: #e1e7f1;
        }

        td {
            border-bottom: 1px solid #f0f0f0;
        }

        td button {
            background-color: #e74c3c;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        td button:hover {
            background-color: #c0392b;
        }

        /* Box Shadow and Hover Effect */
        table, .filters, .search-bar {
            transition: all 0.3s ease;
        }

        table:hover {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .filters:hover, .search-bar:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                align-items: center;
            }

            .filters label {
                margin-bottom: 10px;
            }

            .search-bar input {
                width: 80%;
                max-width: 300px;
            }

            table {
                font-size: 12px;
            }
        }

        /* Style for disabled button */
td button:disabled {
    background-color: #ccc;
    color: #777;
    cursor: not-allowed;
    pointer-events: none;
}

        
        
      .booking {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
        }
        .paid {
            background-color: #d4edda;
        }
        .pending {
            background-color: #fff3cd;
        }
        .failed {
            background-color: #f8d7da;
        }
        .booking-id {
            font-weight: bold;
        }
        .status {
            margin-top: 5px;
            padding: 5px;
            font-size: 14px;
        }
        body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

.container {
    width: 80%;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

h1, h2 {
    color: #333;
}

.form-container, #specialOffersContainer {
    margin-bottom: 30px;
}

form input, form textarea, form button {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

button {
    background-color: #4CAF50;
    color: white;
    cursor: pointer;
    border: none;
}

button:hover {
    background-color: #45a049;
}

ul {
    list-style-type: none;
    padding-left: 0;
}

ul li {
    background-color: #f9f9f9;
    padding: 15px;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 4px;
}

ul li button {
    background-color: #f44336;
}

ul li button:hover {
    background-color: #d32f2f;
}

ul li span {
    margin-left: 15px;
    color: #555;
}

 /* Basic styling for modal */
 #hotelImagesModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }
        #imageUploadStep {
            background: #fff;
            width: 80%;
            margin: 50px auto;
            padding: 20px;
            border-radius: 10px;
        }
        .upload-step {
            margin-bottom: 20px;
        }
        .image-upload-item {
            margin-bottom: 10px;
        }
        
        #hotelImagesButton {
            padding: 10px;
            cursor: pointer;
        }


        /* Ensure room pictures container is hidden by default */
.room-pictures-container {
    display: none; /* Hidden by default */
}


        /* Modal Styles */
.modal-detals {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4); /* Background color */
    padding-top: 60px;
}

.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close-btn {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close-btn:hover,
.close-btn:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4); /* Black with opacity */
    padding-top: 60px;
}

.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close-btn:hover,
.close-btn:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.room-image {
    width: 200px;
    height: auto;
    margin: 10px;
}

        #pathMap {
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .hotel-marker {
            background-color: #4CAF50;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .door-marker {
            background-color: #f44336;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 5px;
}

.close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close-btn:hover {
    color: black;
}

.path-point {
    background-color: #4CAF50;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.path-point.has-image {
    background-color: #2196F3;
}

.path-point:hover::after {
    content: attr(data-description);
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 5px;
    border-radius: 3px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
}
</style>
</head>
<body>
  <!-- Add this after the hotel details section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Walking Path to Haram</h5>
            </div>
            <div class="card-body">
            <div id="pathMap"></div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="pathName">Path Name</label>
                            <input type="text" class="form-control" id="pathName" placeholder="e.g., Main Path to Door 1">
                        </div>
                        <div class="form-group">
                            <label for="pathDescription">Description</label>
                            <textarea class="form-control" id="pathDescription" rows="3" placeholder="Describe the path..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="startDoor">Destination Door</label>
                            <select class="form-control" id="startDoor">
                                <option value="">Select a door</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Path Details</label>
                            <div id="pathDetails" class="alert alert-info"></div>
                        </div>
                        <button id="savePath" class="btn btn-primary">Save Path</button>
                        <button id="clearPath" class="btn btn-secondary">Clear Path</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Image Upload Modal -->
        <div id="imageUploadModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-btn" onclick="closeImageModal()">&times;</span>
                <h4>Add Image for Path Point</h4>
                <form id="imageUploadForm">
                    <div class="form-group">
                        <label for="segmentImage">Select Image:</label>
                        <input type="file" id="segmentImage" accept="image/*" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="imageDescription">Description:</label>
                        <textarea id="imageDescription" class="form-control" rows="3" placeholder="Describe this point..."></textarea>
                    </div>
                    <div id="imagePreview" style="margin: 10px 0; display: none;">
                        <img id="previewImg" src="" style="max-width: 100%; max-height: 200px;">
                    </div>
                    <button type="button" class="btn btn-primary" onclick="saveSegmentImage()">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeImageModal()">Cancel</button>
                </form>
            </div>
        </div>

        <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 5px;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: black;
        }

        .path-point {
            background-color: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .path-point.has-image {
            background-color: #2196F3;
        }

        .path-point:hover::after {
            content: attr(data-description);
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        </style>

        <script>
        // Global variables for path drawing
        let pathMap;
        let pathLayer;
        let pathPoints = [];
        let hotelMarker;
        let doorMarkers = [];
        let currentPointIndex = -1;

        // Show image upload modal
        function showImageModal(pointIndex) {
            const modal = document.getElementById('imageUploadModal');
            const imageInput = document.getElementById('segmentImage');
            const descriptionInput = document.getElementById('imageDescription');
            const previewDiv = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            
            // Reset form
            imageInput.value = '';
            descriptionInput.value = '';
            previewDiv.style.display = 'none';
            previewImg.src = '';
            
            // Show modal
            modal.style.display = 'block';
            currentPointIndex = pointIndex;
            
            // Preview image when selected
            imageInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        previewDiv.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            };
        }

        // Close image modal
        function closeImageModal() {
            document.getElementById('imageUploadModal').style.display = 'none';
        }

        // Save segment image
        function saveSegmentImage() {
            const imageInput = document.getElementById('segmentImage');
            const descriptionInput = document.getElementById('imageDescription');
            const file = imageInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Store image as base64 and description
                    pathPoints[currentPointIndex].image = e.target.result;
                    pathPoints[currentPointIndex].description = descriptionInput.value;
                    
                    // Update point marker style
                    const pointMarker = pathPoints[currentPointIndex].marker;
                    if (pointMarker) {
                        pointMarker.getElement().classList.add('has-image');
                        pointMarker.getElement().setAttribute('data-description', descriptionInput.value);
                    }
                    
                    // Close modal
                    closeImageModal();
                    
                    // Update path details
                    updatePathDetails();
                };
                reader.readAsDataURL(file);
            } else {
                // If no image, just save description
                pathPoints[currentPointIndex].description = descriptionInput.value;
                closeImageModal();
                updatePathDetails();
            }
        }

        // Update path details display
        function updatePathDetails() {
            const detailsDiv = document.getElementById('pathDetails');
            let details = `<p><strong>Points:</strong> ${pathPoints.length}</p>`;
            
            // Calculate total distance
            const totalDistance = calculatePathDistance(pathPoints.map(p => [p.lat, p.lng]));
            const estimatedTime = Math.ceil(totalDistance * 12); // Assuming 5 km/h walking speed
            
            details += `<p><strong>Distance:</strong> ${totalDistance.toFixed(2)} km</p>`;
            details += `<p><strong>Estimated Time:</strong> ${estimatedTime} minutes</p>`;
            
            // Add image and description information
            pathPoints.forEach((point, index) => {
                details += `<p><strong>Point ${index + 1}:</strong> `;
                if (point.image) {
                    details += 'Has image';
                }
                if (point.description) {
                    details += ` - ${point.description}`;
                }
                details += '</p>';
            });
            
            detailsDiv.innerHTML = details;
        }

        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize map
            pathMap = L.map('pathMap').setView([21.4225, 39.8262], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(pathMap);

            // Add hotel marker
            const hotelLat = parseFloat(localStorage.getItem('hotelLat'));
            const hotelLng = parseFloat(localStorage.getItem('hotelLng'));
            if (hotelLat && hotelLng) {
                hotelMarker = L.marker([hotelLat, hotelLng]).addTo(pathMap);
                pathMap.setView([hotelLat, hotelLng], 15);
            }

            // Load doors
            fetch('http://localhost:5000/api/doors')
                .then(response => response.json())
                .then(doors => {
                    const doorSelect = document.getElementById('startDoor');
                    // Clear existing options except the first one
                    while (doorSelect.options.length > 1) {
                        doorSelect.remove(1);
                    }
                    
                    doors.forEach(door => {
                        // Add to select dropdown
                        const option = document.createElement('option');
                        option.value = door._id;
                        option.textContent = door.name;
                        doorSelect.appendChild(option);

                        // Add marker to map and store with door data
                        const marker = L.marker([door.coordinates.lat, door.coordinates.lon], {
                            title: door.name
                        }).addTo(pathMap);
                        
                        // Store door data with the marker
                        marker.doorData = {
                            id: door._id,
                            name: door.name,
                            coordinates: door.coordinates
                        };
                        
                        doorMarkers.push(marker);
                    });
                });

            // Add click handler for path drawing
            pathMap.on('click', function(e) {
                if (!pathLayer) {
                    pathPoints = [];
                    pathLayer = L.polyline([], {
                        color: '#4CAF50',
                        weight: 6,
                        opacity: 0.9
                    }).addTo(pathMap);
                }
                
                // Add point to path with image and description properties
                const point = {
                    lat: e.latlng.lat,
                    lng: e.latlng.lng,
                    image: null,
                    description: '',
                    marker: L.marker(e.latlng, {
                        icon: L.divIcon({
                            className: 'path-point',
                            html: `<div class="path-point">${pathPoints.length + 1}</div>`,
                            iconSize: [24, 24]
                        })
                    }).addTo(pathMap)
                };
                
                // Add click handler to marker for editing
                point.marker.on('click', function() {
                    currentPointIndex = pathPoints.indexOf(point);
                    showImageModal(currentPointIndex);
                });
                
                pathPoints.push(point);
                currentPointIndex = pathPoints.length - 1;
                
                // Update path layer
                pathLayer.setLatLngs(pathPoints.map(p => [p.lat, p.lng]));
                
                // Show image upload modal
                showImageModal(currentPointIndex);
                
                // Enable save button if we have at least 2 points
                if (pathPoints.length >= 2) {
                    document.getElementById('savePath').disabled = false;
                }
            });

            // Add save path handler
            const savePathButton = document.getElementById('savePath');
            // Remove any existing event listeners
            const newSavePathButton = savePathButton.cloneNode(true);
            savePathButton.parentNode.replaceChild(newSavePathButton, savePathButton);

            newSavePathButton.addEventListener('click', async function(e) {
                e.preventDefault(); // Prevent default form submission
                
                const pathName = document.getElementById('pathName').value;
                const pathDescription = document.getElementById('pathDescription').value;
                const startDoor = document.getElementById('startDoor').value;
                const hotelId = '6844e2596e4bf672d629e738';

                if (!pathName || !startDoor || pathPoints.length < 2 || !hotelId) {
                    alert('Please fill in all fields and draw a valid path');
                    return;
                }

                try {
                    // Disable the save button to prevent double submission
                    newSavePathButton.disabled = true;

                    // Calculate total distance
                    const totalDistance = calculatePathDistance(pathPoints.map(p => [p.lat, p.lng]));
                    const estimatedTime = Math.ceil(totalDistance * 12); // Assuming 5 km/h walking speed

                    // Get the selected door's data
                    const selectedDoorMarker = doorMarkers.find(marker => marker.doorData.id === startDoor);
                    if (!selectedDoorMarker) {
                        throw new Error('Selected door not found');
                    }

                    // Get hotel coordinates from localStorage
                    const hotelLat = parseFloat(localStorage.getItem('hotelLat'));
                    const hotelLng = parseFloat(localStorage.getItem('hotelLng'));

                    if (!hotelLat || !hotelLng) {
                        throw new Error('Hotel coordinates not found');
                    }

                    // Format the path data according to the API schema
                    const pathData = {
                        name: pathName,
                        description: pathDescription,
                        hotelId: hotelId,
                        startPoint: {
                            name: "Hotel Entrance",
                            coordinates: {
                                lat: hotelLat,
                                lon: hotelLng
                            }
                        },
                        destination: {
                            name: selectedDoorMarker.doorData.name,
                            coordinates: {
                                lat: selectedDoorMarker.doorData.coordinates.lat,
                                lon: selectedDoorMarker.doorData.coordinates.lon
                            }
                        },
                        distance: totalDistance,
                        estimatedTime: estimatedTime,
                        coordinates: pathPoints.map(point => ({
                            lat: point.lat,
                            lon: point.lng,
                            image: point.image || null,
                            description: point.description || ''
                        }))
                    };

                    console.log('Sending path data:', pathData); // Debug log

                    const response = await fetch('http://localhost:5000/api/walking-paths', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(pathData)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    alert('Path saved successfully!');
                    window.location.reload();
                } catch (error) {
                    console.error('Error saving path:', error);
                    alert('Failed to save path: ' + error.message);
                    // Re-enable the save button if there's an error
                    newSavePathButton.disabled = false;
                }
            });
        });
        </script>

    <h1>Manage Hotel URL</h1>

    <form id="url-form">
        <input type="text" id="hotelUrl" placeholder="Hotel URL" required><br><br>
        <button type="submit">Add/Update URL</button>
    </form>
    
    <button onclick="deleteHotelUrl()">Delete Hotel URL</button>
  
    
    <h1>Hotel Distance to Haram</h1>

    <!-- Form to add/update the distance -->
    <form id="distanceForm">
        <input type="text" id="distance" placeholder="Distance to Haram (e.g., 5 km)" required><br>
        <select id="haram">
            <option value="mecca">Mecca</option>
            <option value="medinah">Medina</option>
        </select><br>
        <button type="submit">Add/Update Distance</button>
    </form>

    <br>

    <!-- Button to delete the distance -->
    <button id="deleteButton">Delete Distance</button>

    <br><br>

    <!-- Display current distances -->
    <h3>Current Distance to Haram</h3>
    <p id="currentMeccaDistance"></p>
    <p id="currentMedinaDistance"></p>
    


<!-- Modal for Image Upload -->
<div id="uploadImageModal" style="display: none;">
    <div class="modal-content">
        <h2>Upload Image for Room</h2>
        <form id="uploadImageForm" enctype="multipart/form-data">
            <input type="hidden" id="room-id-input" name="roomId" value="">
            <label for="category-input">Category:</label>
            <input type="text" id="category-input" name="category" placeholder="Enter category" required>
            <br>
            <label for="image-upload-input">Select Image:</label>
            <input type="file" id="image-upload-input" name="image" accept="image/*" required>
            <br>
            <label for="image-description-input">Description:</label>
            <textarea id="image-description-input" name="description" required></textarea>
            <br>
            <button type="submit">Upload Image</button>
            <button type="button" onclick="closeModal()">Cancel</button>
        </form>
    </div>
</div>


    <div id="room-images-container"></div>
    <!-- Filters Section -->
    <div class="filters">
        <label><input type="checkbox" id="refunded-filter"> Show Refunded</label>
        <label><input type="checkbox" id="checkin-today-filter"> Show Check-ins Today</label>
        <label><input type="checkbox" id="checkout-today-filter"> Show Check-outs Today</label>
        <label><input type="checkbox" id="current-week-filter"> Show Bookings This Week</label>
    </div>

    <!-- Search Bar Section -->
    <div class="search-bar">
        <input type="text" id="search-bar" placeholder="Search by Customer Name or Confirmation Number">
    </div>

    <!-- Table to display bookings -->
    <table id="bookings-table" border="1">
        <thead>
            <tr>
                <th>Confirmation Number</th>
                <th>Customer Name</th>
                <th>Room Type</th>
                <th>Check-in Date</th>
                <th>Check-out Date</th>
                <th>Booking Date</th>
                <th>Total Amount</th>
                <th>Payment Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Booking rows will be populated here -->
        </tbody>
    </table>
    

    <h2>Create New Hotel</h2>
<form id="create-hotel-form">
    <label for="hotelName">Hotel Name:</label>
    <input type="text" id="hotelName" required><br>

    <label for="location">Location:</label>
    <input type="text" id="location" required><br>

    <label for="manager">Manager:</label>
    <input type="text" id="manager" required><br>

    <label for="contactInfo">Contact Info:</label>
    <input type="text" id="contactInfo" required><br>

    <label for="capacity">Capacity:</label>
    <input type="number" id="capacity" required><br>

    <label for="roomsAvailable">Rooms Available:</label>
    <input type="number" id="roomsAvailable" required><br>

    <label for="country">Country:</label>
    <input type="text" id="country" required><br>

    <!-- New Address Fields -->
    <label for="address">Address:</label>
    <input type="text" id="address" required><br>

    <label for="city">City:</label>
    <input type="text" id="city" required><br>

    <label for="zipCode">Zip Code:</label>
    <input type="text" id="zipCode" required><br>

    <label for="state">State:</label>
    <input type="text" id="state" required><br>

    <label for="email">Email:</label>
    <input type="email" id="email" required><br>

    <label for="about">About the Hotel:</label>
    <textarea id="about" placeholder="Write something about the hotel" required></textarea><br>

    <label for="price">Price:</label>
    <input type="number" id="price" required><br>

    <button type="submit">Create Hotel</button>
</form>



<!-- Display hotel details -->

<h2>Hotel Details</h2>
<button id="fetch-hotel-details">Fetch Hotel Details</button>
<div id="hotel-details">
    <p><strong>Hotel Name:</strong> <span id="hotel-name"></span></p>
    <p><strong>Location:</strong> <span id="hotel-location"></span></p>
    <p><strong>Manager:</strong> <span id="hotel-manager"></span></p>
    <p><strong>Contact Info:</strong> <span id="hotel-contact"></span></p>
    <p><strong>Capacity:</strong> <span id="hotel-capacity"></span></p>
    <p><strong>Rooms Available:</strong> <span id="rooms-available"></span></p>
    <p><strong>About the Hotel:</strong> <span id="hotel-about"></span></p>
    <h3>Hotel Images</h3>
    <div id="hotel-images">
        <!-- Hotel images will be displayed here -->
    </div>

    <!-- Edit Image Form (Will be displayed on Edit Button Click) -->
<div id="edit-image-form" style="display: none;">
    <h3>Edit Image</h3>
    <form id="edit-image-form">
        <input type="file" id="image-file" name="image" required>
        <input type="text" id="category-input-hotel" name="category" placeholder="Enter Category" required>
        <input type="text" id="description-input-hotel" name="description" placeholder="Enter Description" required>
        <button type="submit">Submit</button>
        <button type="button" id="cancel-edit">Cancel</button>
    </form>
</div>



<!-- Button to trigger Edit Image -->
<button id="edit-image-btn" style="display: none;">Edit Image</button>

    <!-- Button to toggle room images -->
<button id="room-images-btn" style="display: none;">Show Room Images</button>

<!-- Container for displaying room images -->
<div id="room-images" style="display: none;"></div>
</div>


<form id="setRoomPricesForm">
    <h3>Set Room Prices</h3>
  
    <!-- Hidden field for hotelId -->
    <input type="hidden" id="hotelId" value="5a844b42-fc2b-48e3-9bb5-071f65d563b1">
  
    <div>
      <label for="roomTypeA">Room Type:</label>
      <select id="roomTypeA" name="roomType">
        <option value="Single">Single</option>
        <option value="Double">Double</option>
        <option value="Deluxe">Deluxe</option>
        <option value="Family">Family</option>
        <!-- Add more room types if needed -->
      </select>
    </div>
  
    <div>
      <label for="priceA">Price:</label>
      <input type="number" id="priceA" name="price" required>
    </div>
  
    <button type="submit">Save Price</button>
  </form>

<h3>Available Rooms</h3>
<div id="available-rooms">
    <!-- Available rooms will be displayed here -->
</div>

   <!-- Form to update key status -->
<h3>Update Client Key Status</h3>
<form id="update-key-status-form">
    <label for="client-id">Client ID:</label>
    <input type="text" id="client-id" required>

    <label for="room-id">Room ID:</label>
    <input type="text" id="room-id" required>

    <label for="has-key">Has Key:</label>
    <input type="checkbox" id="has-key">

    <button type="submit">Update Key Status</button>
</form>




<h1>Room Management</h1>
<label for="room-type-select">Select Room Type:</label>
<select id="room-type-select">
    <option value="Single">Single</option>
    <option value="Double">Double</option>
    <option value="Deluxe">Deluxe</option>
    <option value="Family">Family</option>
</select>
<button id="fetch-room-data-btn">Fetch Room Data</button>

<!-- Room Details Section -->
<div id="room-details-section" style="display:none;">
    <h2>Room Description</h2>
    <p id="room-description-text"></p>
    
    <h3>Room Equipment</h3>
    <ul id="equipment-list"></ul>

    <!-- Edit Button -->
    <button id="edit-description-btn" data-room-type="" style="display:none;">Edit Description</button>
</div>

<!-- Edit Description Modal (hidden by default) -->
<div id="roomDescriptionEditModal" style="display:none;">
    <h2>Edit Room Description & Equipment</h2>
    
    <label for="room-description-edit">Room Description:</label>
    <textarea id="room-description-edit" rows="4" cols="50"></textarea>
    
    <h3>Room Equipment</h3>
    <div id="equipment-edit-section">
        <!-- Dynamically load equipment fields here -->
    </div>

    <button id="save-room-description-btnR">Save Changes</button>
    <button id="cancel-edit-btnR">Cancel</button>
</div>

<!-- Room Images Modal -->
<div id="room-images-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn" id="close-modal-btn">&times;</span>
        <h2>Room Images</h2>
        <div id="room-images-container"></div> <!-- Images will be added here -->
    </div>
</div>


<h1>Room Management for Hotel</h1>
    <table id="rooms-table">
        <thead>
            <tr>
                <th>Room Number</th>
                <th>Bed Number</th>
                <th>Level</th>
                <th>People in Room</th>
                <th>Price</th> <!-- Add Price Column -->
                <th>Clients</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Room rows will go here -->
        </tbody>
    </table>



<form id="add-client-form">
    <input type="text" id="room-id-add" placeholder="Room ID" />
    <input type="text" id="client-id-add" placeholder="Client ID" />
    <button type="submit">Add Client</button>
</form>

<form id="addClientForm">
    <!-- form fields here -->
</form>

 <!-- Modal for Facility Form -->
 <div id="facility-modal" style="display: none;">
    <form id="facility-form">
        <input type="hidden" id="facility-id">  <!-- Hidden input for room services ID -->
        <label for="facility-name">Facility Name</label>
        <input type="text" id="facility-name" name="facility-name">
        <label for="facility-description">Facility Description</label>
        <input type="text" id="facility-description" name="facility-description">
        <label for="facility-status">Available</label>
        <input type="checkbox" id="facility-status" name="facility-status">
        <button type="submit" id="save-facility-btn">Save</button>
    </form>
</div>

<!-- Facilities Section -->
<div id="facilities">
    <h2>Manage Facilities</h2>
    <table id="facilities-table">
        <thead>
            <tr>
                <th>Facility Name</th>
                <th>Description</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Facilities list will be loaded here -->
        </tbody>
    </table>
    <button id="add-facility-btn">Add New Facility</button>
</div>
<!-- Modal for RoomServices Form -->
<!-- Modal for RoomServices Form -->
<div id="room-services-modal" style="display: none;">
    <form id="room-services-form">
        <input type="hidden" id="room-services-id">  <!-- Hidden input for room services ID -->
        <label for="room-services-name">RoomServices Name</label>
        <input type="text" id="room-services-name" name="room-services-name">
        <label for="room-services-description">RoomServices Description</label>
        <input type="text" id="room-services-description" name="room-services-description">
        <label for="room-services-status">Available</label>
        <input type="checkbox" id="room-services-status" name="room-services-status">
        <button type="submit" id="save-room-services-btn">Save</button>
    </form>
</div>

<!-- Room Services Section -->
<div id="room-services">
    <h2>Manage Room Services</h2>
    <table id="room-services-table">
        <thead>
            <tr>
                <th>RoomServices Name</th>
                <th>Description</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Room Services list will be loaded here -->
        </tbody>
    </table>
    <button id="add-room-services-btn">Add New RoomServices</button>
</div>

<!-- Amenities Section -->
<div id="amenities">
    <h2>Manage Amenities</h2>
    <table id="amenities-table">
        <thead>
            <tr>
                <th>Amenity Name</th>
                <th>Description</th>
                <th>Included</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Amenities list will be loaded here -->
        </tbody>
    </table>
    <button id="add-amenity-btn">Add New Amenity</button>
</div>

<!-- Modal for Amenities Form -->
<div id="amenity-modal" style="display: none;">
    <form id="amenity-form">
        <input type="hidden" id="amenity-id"> <!-- Hidden field for amenity ID -->

         <!-- Amenity Name Dropdown -->
         <label for="amenity-name">Amenity Name</label>
         <select id="amenity-name" name="amenity-name" required>
             <option value="Pick Up & Drop">Pick Up & Drop</option>
             <option value="Room Service">Room Service</option>
             <option value="Parking Space">Parking Space</option>
             <option value="Indoor Pool">Indoor Pool</option>
             <option value="Free Internet">Free Internet</option>
             <option value="Breakfast">Breakfast</option>
             <option value="Meeting Facilities">Meeting Facilities</option>
             <option value="Wheelchair Friendly">Wheelchair Friendly</option>
         </select>
        <label for="amenity-description">Amenity Description</label>
        <input type="text" id="amenity-description" name="amenity-description" required>
        <label for="amenity-included">Included</label>
        <input type="checkbox" id="amenity-included" name="amenity-included">
        <button type="submit" id="save-amenity-btn">Save</button>
    </form>
</div>

<!-- Emergency Contacts Section -->
<div id="emergency-contacts">
    <h2>Manage Emergency Contacts</h2>
    <table id="emergency-contacts-table">
        <thead>
            <tr>
                <th>Contact Name</th>
                <th>Contact Number</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Emergency Contacts list will be loaded here -->
        </tbody>
    </table>
    <button id="add-emergency-contact-btn">Add New Contact</button>
</div>

<!-- Modal for Emergency Contact Form -->
<div id="emergency-contact-modal" style="display: none;">
    <form id="emergency-contact-form">
        <input type="hidden" id="contact-id"> <!-- Hidden field for contact ID -->

        <label for="contact-name">Contact Name</label>
        <input type="text" id="contact-name" name="contact-name" required>
        
        <label for="contact-number">Contact Number</label>
        <input type="text" id="contact-number" name="contact-number" required>
        
        <button type="submit" id="save-contact-btn">Save</button>
    </form>
</div>

<!-- Events Section -->
<h2>Events</h2>
<button id="add-event-btn">Add Event</button>
<table id="events-table">
    <thead>
        <tr>
            <th>Event Name</th>
            <th>Event Type</th>
            <th>Date</th>
            <th>Attendees</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Event rows will be dynamically inserted here -->
    </tbody>
</table>

<!-- Event Modal (For Add/Edit) -->
<div id="event-modal" style="display:none;">
    <form id="event-form">
        <input type="hidden" id="event-id"> <!-- Hidden input for event ID -->
        
        <label for="event-name">Event Name</label>
        <input type="text" id="event-name" required>

        <label for="event-type">Event Type</label>
        <select id="event-type" required>
            <option value="Conference">Conference</option>
            <option value="Wedding">Wedding</option>
            <option value="Party">Party</option>
            <option value="Seminar">Seminar</option>
            <option value="Concert">Concert</option>
        </select>

        <label for="event-date">Event Date</label>
        <input type="date" id="event-date" required>

        <label for="event-attendees">Attendees</label>
        <input type="number" id="event-attendees" required>

        <label for="event-description">Description</label>
        <textarea id="event-description" required></textarea>

        <button type="submit" id="save-event-btn">Save</button>
        <!-- Update button for updating an existing event -->
        <button id="update-event-btn" style="display:none;">Update Event</button>
    </form>
</div>


<!-- Policies Section -->
<h2>Hotel Policies</h2>
<button id="add-policy-btn">Add Policy</button>
<table id="policies-table">
    <thead>
        <tr>
            <th>Check-In Time</th>
            <th>Check-Out Time</th>
            <th>Pet Policy</th>
            <th>Cancellation Policy</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Policy rows will be dynamically inserted here -->
    </tbody>
</table>

<!-- Policy Modal (For Add/Edit) -->
<div id="policy-modal" style="display:none;">
    <form id="policy-form">
        <input type="hidden" id="policy-id"> <!-- Hidden input for policy ID -->
        
        <label for="check-in-time">Check-In Time</label>
        <input type="text" id="check-in-time" required>

        <label for="check-out-time">Check-Out Time</label>
        <input type="text" id="check-out-time" required>

        <label for="pet-policy">Pet Policy</label>
        <textarea id="pet-policy" required></textarea>

        <label for="cancellation-policy">Cancellation Policy</label>
        <textarea id="cancellation-policy" required></textarea>

        <button type="submit" id="save-policy-btn">Save</button>
        <!-- Update button for updating an existing policy -->
        <button id="update-policy-btn" style="display:none;">Update Policy</button>
    </form>
</div>




<div id="payment-methods">
    <h3>Payment Methods</h3>
    <table id="payment-methods-table">
        <thead>
            <tr>
                <th>Method</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Payment methods will be dynamically populated here -->
        </tbody>
    </table>

    <button id="add-payment-method-btn">Add Payment Method</button>
</div>

<!-- Modal for Adding/Editing Payment Methods -->
<div id="payment-method-modal" style="display: none;">
    <form id="payment-method-form">
        <label for="method">Payment Method</label>
        <select id="method">
            <option value="card">Card</option>
            <option value="cash">Cash</option>
            <option value="paypal">PayPal</option>
        </select>
        <label for="description">Description</label>
        <input type="text" id="description" required />
        <button type="submit">Save</button>
    </form>
</div>


<div id="booking-form">
    <h3>Complete Your Booking</h3>

    <label for="payment-method">Choose Payment Method</label>
    <select id="payment-method" required>
        <!-- Payment methods will be populated dynamically -->
    </select>

    <button id="pay-now-btn">Pay Now</button>
</div>

<h1>Hotel Bookings</h1>

<div id="booking-list">
    <!-- Bookings will be displayed here -->
</div>

<div id="alerts">
    <h2>Manage Alerts</h2>
    <table id="alerts-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Message</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Alerts list will be loaded here -->
        </tbody>
    </table>
    <button id="add-alert-btn">Add New Alert</button>
</div>

<!-- Modal for Alert Form -->
<div id="alert-modal" style="display: none;">
    <form id="alert-form">
        <input type="hidden" id="alert-id"> <!-- Hidden field for alert ID -->

        <label for="alert-type">Alert Type</label>
        <input type="text" id="alert-type" name="alert-type" required>

        <label for="alert-message">Alert Message</label>
        <input type="text" id="alert-message" name="alert-message" required>

        <button type="submit" id="save-alert-btn">Save</button>
    </form>
</div>

<h1>Manage Staff Members</h1>
    <button id="add-staff-btn">Add New Staff</button>
    
    <table id="staff-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Role</th>
                <th>Contact Info</th>
                <th>Shift</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Staff members will be dynamically inserted here -->
        </tbody>
    </table>

    <!-- Modal for adding/updating staff -->
    <div id="staff-modal" style="display:none;">
        <h2 id="modal-title">Add New Staff</h2>
        <form id="staff-form">
            <input type="hidden" id="staff-id">
            <label for="staff-name">Name:</label>
            <input type="text" id="staff-name" required><br>
            <label for="staff-role">Role:</label>
            <input type="text" id="staff-role" required><br>
            <label for="staff-contact-info">Contact Info:</label>
            <input type="text" id="staff-contact-info" required><br>
            <label for="staff-shift">Shift:</label>
            <input type="text" id="staff-shift"><br>
            <label for="staff-status">Status:</label>
            <input type="text" id="staff-status" required><br>
            <button type="submit" id="save-staff-btn">Save</button>
        </form>
        <button id="close-modal-btn">Close</button>
    </div>
    <h1>Hotel Special Offers</h1>

<!-- Button to show the add new special offer form -->
<button id="addOfferButton">Add New Special Offer</button>

<!-- Add new special offer (Initially hidden) -->
<div class="form-container" id="addOfferFormContainer" style="display: none;">
    <h2 id="formTitle">Add New Special Offer</h2>
    <form id="addOfferForm">
        <input type="text" id="offerName" placeholder="Offer Name" required>
        <textarea id="description" placeholder="Description" required></textarea>
        <input type="number" id="discountPercentage" placeholder="Discount Percentage" required>
        <input type="date" id="validFrom" required>
        <input type="date" id="validUntil" required>
        <button type="submit" id="formSubmitButton">Add Offer</button>
    </form>
</div>

<!-- List current special offers -->
<div id="specialOffersContainer">
    <h2>Current Special Offers</h2>
    <ul id="specialOffersList"></ul>
</div>


<!-- Hotel Image Upload Button -->
<button id="hotelImagesButton" onclick="openHotelImagesModal()">Hotel Images</button>

<!-- Hotel Image Upload Modal (Hidden by default) -->
<div id="hotelImagesModal" style="display:none;">
    <div id="imageUploadStep">
        <!-- Step 1: Upload Banner Images (1 to 21) -->
        <!-- Step 1: Upload Banner Images (1 to 21) -->
<div id="step1" class="upload-step">
    <h3>Step 1: Upload Banner Images (1 to 21)</h3>
    <p>Please upload the images for the Banner (1 to 21).</p>
    <div id="bannerImagesContainer"></div>
    <button id="nextStepBtn1" style="display:none;" onclick="goToNextStep(2)">Go to Step 2</button>
</div>

<!-- Step 2: Upload Blog Images (1 to 6) -->
<div id="step2" class="upload-step" style="display:none;">
    <h3>Step 2: Upload Blog Images (1 to 6)</h3>
    <div id="blogImagesContainer"></div>
    <button id="nextStepBtn2" style="display:none;" onclick="goToNextStep(3)">Go to Step 3</button>
</div>

<!-- Step 3: Upload Offers Images (1 to 12) -->
<div id="step3" class="upload-step" style="display:none;">
    <h3>Step 3: Upload Offers Images (1 to 12)</h3>
    <div id="offersImagesContainer"></div>
    <button id="nextStepBtn3" style="display:none;" onclick="goToNextStep(4)">Go to Step 4</button>
</div>

<!-- Step 4: Upload Pricing Images (1 to 3) -->
<div id="step4" class="upload-step" style="display:none;">
    <h3>Step 4: Upload Pricing Images (1 to 3)</h3>
    <div id="pricingImagesContainer"></div>
    <button id="nextStepBtn4" style="display:none;" onclick="goToNextStep(5)">Go to Step 5</button>
</div>

<!-- Step 5: Upload Rooms Images (1 to 12) -->
<div id="step5" class="upload-step" style="display:none;">
    <h3>Step 5: Upload Rooms Images (1 to 12)</h3>
    <div id="roomsImagesContainer"></div>
    <button id="nextStepBtn5" style="display:none;" onclick="goToNextStep(6)">Go to Step 6</button>
</div>

<!-- Step 6: Upload Spa Images (1 to 5) -->
<div id="step6" class="upload-step" style="display:none;">
    <h3>Step 6: Upload Spa Images (1 to 5)</h3>
    <div id="spaImagesContainer"></div>
    <button id="nextStepBtn6" style="display:none;" onclick="goToNextStep(7)">Go to Step 7</button>
</div>

<!-- Step 7: Upload Team Images (1 to 5) -->
<div id="step7" class="upload-step" style="display:none;">
    <h3>Step 7: Upload Team Images (1 to 5)</h3>
    <div id="teamImagesContainer"></div>
    <button id="nextStepBtn7" style="display:none;" onclick="goToNextStep(8)">Go to Step 8</button>
</div>

<!-- Step 8: Upload Clients Images (1 to 6) -->
<div id="step8" class="upload-step" style="display:none;">
    <h3>Step 8: Upload Clients Images (1 to 6)</h3>
    <div id="clientsImagesContainer"></div>
    <button id="nextStepBtn8" style="display:none;" onclick="goToNextStep(9)">Go to Step 9</button>
</div>

<!-- Step 9: Upload About Images (1 to 2) -->
<div id="step9" class="upload-step" style="display:none;">
    <h3>Step 9: Upload About Images (1 to 2)</h3>
    <div id="aboutImagesContainer"></div>
    <button id="nextStepBtn9" style="display:none;" onclick="goToNextStep(10)">Go to Step 10</button>
</div>

<!-- Step 10: Upload Contact Images (1 to 3) -->
<div id="step10" class="upload-step" style="display:none;">
    <h3>Step 10: Upload Contact Images (1 to 3)</h3>
    <div id="contactImagesContainer"></div>
    <button id="nextStepBtn10" style="display:none;" onclick="goToNextStep(11)">Go to Step 11</button>
</div>

<!-- Step 11: Upload Favicon (1) -->
<div id="step11" class="upload-step" style="display:none;">
    <h3>Step 11: Upload Favicon (1)</h3>
    <div id="faviconImagesContainer"></div>
    <button id="nextStepBtn11" style="display:none;" onclick="goToNextStep(12)">Go to Step 12</button>
</div>

<!-- Step 12: Upload Logo (1 to 2) -->
<div id="step12" class="upload-step" style="display:none;">
    <h3>Step 12: Upload Logo (1 to 2)</h3>
    <div id="logoImagesContainer"></div>
    <button id="nextStepBtn12" style="display:none;" onclick="goToNextStep(13)">Go to Step 13</button>
</div>

<!-- Step 13: Upload Preloader Image (1) -->
<div id="step13" class="upload-step" style="display:none;">
    <h3>Step 13: Upload Preloader Image (1)</h3>
    <div id="preloaderImagesContainer"></div>
    <button id="nextStepBtn13" style="display:none;" onclick="goToNextStep(14)">Go to Step 14</button>
</div>

<!-- Step 4: Upload restaurant Images (1 to 3) -->
<div id="step14" class="upload-step" style="display:none;">
    <h3>Last Step: Upload Restaurant Images (1 to 6)</h3>
    <div id="restaurantImagesContainer"></div>
    <button id="nextStepBtn14" style="display:none;" onclick="closeHotelImagesModal()">Close Modal</button>
</div>

<!-- Close Modal button -->
<button onclick="closeHotelImagesModal()">Close</button>


    </div>
</div>

<!-- Banner Images Container -->
<div id="bannerImagesContainer"></div>

<!-- Preloader Images Container -->
<div id="preloaderImagesContainer"></div>

<!-- Add more containers as needed -->


<!-- Hotel Video Upload Button -->
<button id="hotelVideosButton" onclick="openHotelVideosModal()">Hotel Videos</button>

<!-- Hotel Video Upload Modal (Hidden by default) -->
<div id="hotelVideosModal" style="display:none;">
    <div id="videoUploadStep">
        <!-- Step 1: Upload Room Videos (1 to 2) -->
        <!-- Step 2: Upload Pool Videos (1 to 2) -->

        <div id="stepvideo1" class="upload-stepvideo">
            <h3>Step 1: Upload Room Videos (1 to 2)</h3>
            <p>Please upload the videos for the Rooms (1 to 2).</p>
            <div id="roomsVideosContainer"></div>
            <button id="nextStepBtnVideo1" style="display:none;" onclick="goToNextStepVideo(2)">Go to Step 2</button>
        </div>

        <!-- Step 2: Upload Pool Videos (1 to 2) -->
        <div id="stepvideo2" class="upload-stepvideo" style="display:none;">
            <h3>Step 2: Upload Pool Videos (1 to 2)</h3>
            <div id="poolVideosContainer"></div>
            <button id="nextStepBtnVideo2" style="display:none;" onclick="goToNextStepVideo(3)">Go to Step 3</button>
        </div>
        <!-- Step 2: Upload Pool Videos (1 to 2) -->
        <div id="stepvideo3" class="upload-stepvideo" style="display:none;">
            <h3>Step 3: Upload Reception Videos (1 to 2)</h3>
            <div id="receptionVideosContainer"></div>
            <button id="nextStepBtnVideo3" style="display:none;" onclick="goToNextStepVideo(4)">Go to Step 4</button>
        </div>
        <!-- Step 2: Upload Pool Videos (1 to 2) -->
        <div id="stepvideo4" class="upload-stepvideo" style="display:none;">
            <h3>Step 4: Upload General Videos (1 to 2)</h3>
            <div id="generalVideosContainer"></div>
            <button id="nextStepBtnVideo4" style="display:none;" onclick="closeHotelVideosModal()">Close Modal</button>
        </div>
        
        <!-- Close Modal button -->
        <button onclick="closeHotelVideosModal()">Close</button>
    </div>
</div>



<!-- Room Image Upload Modal -->
<div id="roomImagesModal" style="display:none;">
    <form id="roomImageUploadForm" enctype="multipart/form-data">
        <input type="hidden" id="room-id-input" name="roomId">
        <label>Category:</label>
        <select name="category">
            <option value="Window">Window</option>
            <option value="Bathroom">Bathroom</option>
            <option value="Bed">Bed</option>
            <option value="TV">TV</option>
            <option value="Overall">Overall</option>
            <!-- Add more categories as needed -->
        </select>
        <label>Description:</label>
        <input type="text" name="description" placeholder="Optional description">
        <label>Image:</label>
        <input type="file" name="image" required>
        <button type="submit">Upload</button>
    </form>
    <button onclick="closeRoomImagesModal()">Close</button>
</div>

<!-- Room Image Upload Modal for Room Type -->
<div id="roomTypeImagesModal" style="display:block;">
    <form id="roomTypeImageUploadForm" enctype="multipart/form-data">
        <input type="text" name="roomType" id="roomTypeInput" required>
        <label>Category:</label>
        <select name="category">
            <option value="Window">Window</option>
            <option value="Bathroom">Bathroom</option>
            <option value="Bed">Bed</option>
            <option value="TV">TV</option>
            <option value="Overall">Overall</option>
        </select>
        <label>Description:</label>
        <input type="text" name="description" placeholder="Optional description">
        <label>Image:</label>
        <input type="file" name="image" required>
        <button type="submit">Upload for Room Type</button>
    </form>
    <button onclick="closeRoomTypeImagesModal()">Close</button>
</div>

<!-- Video Upload Modal -->
<div id="videoModal" style="display:none;">
    <form id="videoUploadForm" enctype="multipart/form-data">
        <input type="hidden" id="hotel-id-input" name="hotelId">
        <label>Category:</label>
        <select name="category">
            <option value="Hotel Overview">Hotel Overview</option>
            <option value="Pool">Pool</option>
            <option value="Rooms">Rooms</option>
            <!-- Add more categories as needed -->
        </select>
        <label>Description:</label>
        <input type="text" name="description" placeholder="Optional description">
        <label>Video:</label>
        <input type="file" name="video" required accept="video/mp4, video/webm">
        <button type="submit">Upload Video</button>
    </form>
    <button onclick="closeVideoModal()">Close</button>
</div>
<!-- Button to toggle the display of videos -->
<button id="toggleVideosBtn">Toggle Videos</button>

<!-- Video Upload Modal for Room Type -->
<div id="roomTypeVideoModal" style="display:none;">
    <form id="roomTypeVideoUploadForm" enctype="multipart/form-data">
        <input type="text" name="roomType" id="roomTypeInput" required>
        <label>Category:</label>
        <select name="category">
            <option value="Hotel Overview">Hotel Overview</option>
            <option value="Pool">Pool</option>
            <option value="Rooms">Rooms</option>
            <!-- Add more categories as needed -->
        </select>
        <label>Description:</label>
        <input type="text" name="description" placeholder="Optional description">
        <label>Video:</label>
        <input type="file" name="video" required accept="video/mp4, video/webm">
        <button type="submit">Upload for Room Type</button>
    </form>
    <button onclick="closeRoomTypeVideoModal()">Close</button>
</div>


<!-- Modal for Restaurant Form -->
<div id="restaurant-modal" style="display: none;">
    <form id="restaurant-form">
        <input type="hidden" id="restaurant-id"> <!-- Hidden input for restaurant ID -->

        <label for="restaurant-name">Restaurant Name</label>
        <input type="text" id="restaurant-name" name="restaurant-name" required>
        
        <label for="restaurant-type">Restaurant Type</label>
        <select id="restaurant-type" name="restaurant-type" required>
            <option value="Breakfast">Breakfast</option>
            <option value="Lunch">Lunch</option>
            <option value="Dinne">Dinne</option>
            <option value="Drink">Drink</option>
            <option value="Starters">Starters</option>
            <option value="Mains">Mains</option>
            <option value="Salads">Salads</option>
            <option value="Dessert">Dessert</option>
        </select>

        <label for="restaurant-description">Description</label>
        <textarea id="restaurant-description" name="restaurant-description" required></textarea>

        <label for="restaurant-chef">Chef</label>
        <input type="text" id="restaurant-chef" name="restaurant-chef">

        <label for="restaurant-about">About Restaurant</label>
        <textarea id="restaurant-about" name="restaurant-about"></textarea>

        <label for="restaurant-opening-hours-start">Opening Start Time</label>
        <input type="time" id="restaurant-opening-hours-start" name="start">

        <label for="restaurant-opening-hours-end">Opening End Time</label>
        <input type="time" id="restaurant-opening-hours-end" name="end">

        <label for="menu">Menu</label>
        <div id="menu-section">
            <button type="button" id="add-menu-item-btn">Add Menu Item</button>
            <div id="menu-items">
                <!-- Dynamically added menu items will appear here -->
            </div>
        </div>

        <button type="submit" id="save-restaurant-btn">Save</button>
    </form>
</div>


<!-- Restaurant Section -->
<div id="restaurants">
    <h2>Manage Restaurants</h2>
    <table id="restaurant-table">
        <thead>
            <tr>
                <th>Restaurant Name</th>
                <th>Type</th>
                <th>Description</th>
                <th>Opening Hours</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dynamically added restaurant rows will appear here -->
        </tbody>
    </table>
    
    <button id="add-restaurant-btn">Add New Restaurant</button>
</div>

<h1>Spa Services Management</h1>

    <!-- Button to open the "Add Spa Service" form -->
    <button id="add-spa-btn" class="button">Add Spa Service</button>

    <!-- Table for displaying spa services -->
    <table id="spa-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Duration</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Spa services will be dynamically inserted here -->
        </tbody>
    </table>

    <!-- Modal for adding/editing spa service -->
    <div id="spa-modal" class="modal">
        <div class="modal-content">
            <span id="close-modal" class="close-btn">&times;</span>
            <h2 id="modal-title">Add Spa Service</h2>
            <form id="spa-form">
                <input type="hidden" id="spa-id">
                <label for="spa-name">Name:</label><br>
                <input type="text" id="spa-name" required><br><br>
                
                <label for="spa-description">Description:</label><br>
                <input type="text" id="spa-description" required><br><br>
                
                <label for="spa-price">Price:</label><br>
                <input type="number" id="spa-price" required><br><br>
                
                <label for="spa-duration">Duration:</label><br>
                <input type="text" id="spa-duration" required><br><br>
                
                <button type="submit" id="save-spa-btn" class="button">Save</button>
            </form>
        </div>
    </div>

<!-- Modal for Transportation Service Form -->
<div id="transportation-modal" style="display: none;">
    <form id="transportation-form">
        <input type="hidden" id="transportation-id"> <!-- Hidden input for transportation service ID -->

        <label for="transportation-type">Service Type</label>
        <select id="transportation-type" name="transportation-type" required>
            <option value="Shuttle">Shuttle</option>
            <option value="Airport Transfer">Airport Transfer</option>
            <option value="Car Rental">Car Rental</option>
        </select>

        <label for="transportation-description">Description</label>
        <textarea id="transportation-description" name="transportation-description" required></textarea>

        <label for="transportation-price">Price</label>
        <input type="number" id="transportation-price" name="transportation-price" required>

        <label for="transportation-availability">Available</label>
        <input type="checkbox" id="transportation-availability" name="transportation-availability" checked>

        <button type="submit" id="save-transportation-btn">Save</button>
    </form>
</div>

<!-- Transportation Section -->
<div id="transportations">
    <h2>Manage Transportation Services</h2>
    <table id="transportation-table">
        <thead>
            <tr>
                <th>Service Type</th>
                <th>Description</th>
                <th>Price</th>
                <th>Availability</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dynamically added transportation service rows will appear here -->
        </tbody>
    </table>
    
    <button id="add-transportation-btn">Add New Transportation Service</button>
</div>
<table id="accessibility-table">
    <thead>
        <tr>
            <th>Feature</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows will be dynamically populated -->
    </tbody>
</table>
<button id="add-accessibility-btn">Add Accessibility Feature</button>
<div id="accessibility-modal" style="display: none;">
    <form id="accessibility-form">
        <input type="hidden" id="accessibility-id">
        <label for="accessibility-feature">Feature</label>
        <input type="text" id="accessibility-feature" required>

        <label for="accessibility-description">Description</label>
        <textarea id="accessibility-description" required></textarea>

        <button type="submit" id="save-accessibility-btn">Save</button>
    </form>
</div>


<!-- Video Display Containers -->
<div id="roomsVideosContainer" style="display:none;">
<div id="poolVideosContainer"></div>



    </script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  
<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>  <!-- Socket.IO for real-time communication -->

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script type="module">
    import 'https://cdnjs.cloudflare.com/ajax/libs/fetch/3.6.2/fetch.min.js';
</script>
<script src="./hotel.js"></script>

<script>
    const hotelId = window.env.HOTELID1
    document.getElementById("setRoomPricesForm").addEventListener("submit", function(event) {
      event.preventDefault(); // Prevent the form from submitting the traditional way
  
      const roomType = document.getElementById('roomTypeA').value;  // Get selected room type
      const price = document.getElementById('priceA').value;  // Get the entered price
  
      // Make sure all fields are filled in
      if (!hotelId || !roomType || !price) {
        alert('Please fill in all fields.');
        return;
      }
  
      // Now, send the data to the backend (example using fetch)
      fetch('http://localhost:5000/update-room-prices', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          hotelId: hotelId,  // Send the hotelId along with other details
          roomType: roomType,
          price: price
        })
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);  // Handle the response from the server
      })
      .catch(error => {
        console.error('Error updating room price:', error);
        alert('Error updating room price.');
      });
    });
  </script>

    <script>

const socket = io('http://localhost:5000');  // Connect to the backend WebSocket server

// Listen for new booking notifications
socket.on('newBooking', function (data) {
    console.log('New booking received:', data);
    // Update hotel booking UI with the new data
    // You can update your UI here using the data
});


// Handle form submission
document.getElementById('create-hotel-form').addEventListener('submit', async (event) => {
    event.preventDefault();

    const hotelData = {
        hotelName: document.getElementById('hotelName').value,
        location: document.getElementById('location').value,
        manager: document.getElementById('manager').value,
        contactInfo: document.getElementById('contactInfo').value,
        capacity: document.getElementById('capacity').value,
        roomsAvailable: document.getElementById('roomsAvailable').value,
        country: document.getElementById('country').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        zipCode: document.getElementById('zipCode').value,
        state: document.getElementById('state').value,
        email: document.getElementById('email').value,
        about: document.getElementById('about').value,  // Send the about field
        price: document.getElementById('price').value,
    };

    const response = await fetch('http://localhost:5000/add-hotel', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(hotelData),
    });

    const result = await response.json();
    if (response.status === 201) {
        alert('Hotel created successfully!');
    } else {
        alert('Error creating hotel');
    }
});

// Function to fetch and display hotel details along with images
async function fetchHotelDetails(hotelId) {
    // Ensure the hotelId is a valid ObjectId (24 characters)
    if (!hotelId || hotelId.length !== 24) {
        console.error("Invalid hotelId");
        return;
    }

    try {
        // Make API request to the backend to get the hotel details
        const response = await fetch(`http://localhost:5000/get-hotel-details/${hotelId}`);
        const hotel = await response.json();
            console.log(hotel);

        // Check if the response is successful
        if (response.ok) {
            // Update the UI with hotel details
                localStorage.setItem('hotelLat', hotel.coordinates.latitude);
                localStorage.setItem('hotelLng', hotel.coordinates.longitude);
            document.getElementById('hotel-name').textContent = hotel.hotelName;
            document.getElementById('hotel-location').textContent = hotel.location;
            document.getElementById('hotel-manager').textContent = hotel.manager;
            document.getElementById('hotel-contact').textContent = hotel.contactInfo;
            document.getElementById('hotel-capacity').textContent = hotel.capacity;
            document.getElementById('rooms-available').textContent = hotel.roomsAvailable;
            document.getElementById('hotel-about').textContent = hotel.about;  // Display the 'about' field
            document.getElementById("room-images-btn").style.display="block"
            // Call function to display hotel images
            displayHotelImages(hotel.images);
                        // Add a button to toggle room images visibility
                        const roomImagesBtn = document.getElementById('room-images-btn');
            roomImagesBtn.addEventListener('click', () => toggleRoomImages(hotel.roomsImages));
        } else {
            // Handle errors if hotel is not found or other issues
            console.error('Error fetching hotel details:', hotel.message);
        }
    } catch (error) {
        // Log errors if there is a network issue or other errors
        console.error('Error fetching hotel details:', error);
    }
}


// Function to display hotel images and add edit functionality
function displayHotelImages(images, hotelId) {
    const hotelImagesContainer = document.getElementById('hotel-images');
    hotelImagesContainer.innerHTML = ''; // Clear any existing images

    if (images && images.length > 0) {
        images.forEach((image, index) => {
            const imageElement = document.createElement('div');
            imageElement.classList.add('hotel-image');

            // Construct the full URL to the image
            const imageUrl = `http://localhost:5000/${image.url}`;

            imageElement.innerHTML = `
                <h4>${image.category}</h4>
                <img src="${imageUrl}" alt="${image.category}" style="max-width: 300px; margin: 10px;">
                <p>${image.description}</p>
                <button class="edit-image-btn" data-image-id="${image._id}" data-hotel-id="${hotelId}">Edit</button>
            `;
            hotelImagesContainer.appendChild(imageElement);
        });

        // Add event listener for edit buttons
        document.querySelectorAll('.edit-image-btn').forEach(button => {
            button.addEventListener('click', function () {
                const imageId = button.getAttribute('data-image-id');
                const hotelId = button.getAttribute('data-hotel-id');
                showEditForm(imageId); // Show the edit form
            });
        });
    } else {
        hotelImagesContainer.innerHTML = '<p>No images available for this hotel.</p>';
    }
}

// Show the form to edit the image
function showEditForm(imageId) {
    const hotelId = window.env.HOTELID1;  // Example hotelId
    document.getElementById('edit-image-form').style.display = 'block'; // Show form

    const form = document.getElementById('edit-image-form');
    
    // Handle form submission to edit the image
    form.onsubmit = function (event) {
        event.preventDefault(); // Prevent form from refreshing the page

        const formData = new FormData();
        formData.append("image", document.querySelector('#image-file').files[0]);
        formData.append("category", document.querySelector('#category-input-hotel').value);
        formData.append("description", document.querySelector('#description-input-hotel').value);

        console.log("Submitting form for hotelId:", hotelId, "and imageId:", imageId);

        // Call the backend to update the image
        fetch(`http://localhost:5000/edit-hotel-image/${hotelId}/${imageId}`, {
            method: 'PUT',
            body: formData,
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Failed to update image');
            }
        })
        .then(data => {
            if (data.success) {
                console.log('Image updated successfully');
                fetchHotelDetails(hotelId); // Fetch hotel details again to update the UI
                document.getElementById('edit-image-form').style.display = 'none'; // Hide form
            } else {
                console.error('Error updating image:', data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    };

    // Cancel the edit form
    document.getElementById('cancel-edit').addEventListener('click', function () {
        document.getElementById('edit-image-form').style.display = 'none'; // Hide form on cancel
    });
}

// Delete Image
async function deleteImage(imageId) {
   
    const confirmDelete = confirm('Are you sure you want to delete this image?');

    if (confirmDelete) {
        try {
            const response = await fetch(`http://localhost:5000/delete-hotel-image/${hotelId}/${imageId}`, {
                method: 'DELETE',
            });

            const result = await response.json();
            if (response.ok) {
                alert('Image deleted successfully');
                fetchHotelDetails(hotelId);  // Refresh the hotel details after deleting
            } else {
                alert('Error deleting image: ' + result.message);
            }
        } catch (error) {
            console.error('Error deleting image:', error);
        }
    }
}

// Function to toggle and display room images
function toggleRoomImages(roomsImages) {
    const roomImagesContainer = document.getElementById('room-images');
    const isVisible = roomImagesContainer.style.display === 'block';

    if (isVisible) {
        roomImagesContainer.style.display = 'none';
    } else {
        roomImagesContainer.style.display = 'block';
        displayRoomImages(roomsImages, roomImagesContainer);
    }
}

// Function to display room images
function displayRoomImages(roomsImages, container) {
    container.innerHTML = ''; // Clear existing images

    if (roomsImages && roomsImages.length > 0) {
        roomsImages.forEach(roomImage => {
            const roomType = roomImage.roomType;
            roomImage.images.forEach(image => {
                const imageElement = document.createElement('div');
                imageElement.classList.add('room-image');
                
                // Construct the full URL to the image
                const imageUrl = `http://localhost:5000/${image.url}`;

                imageElement.innerHTML = `
                    <h5>${roomType} - ${image.category}</h5>
                    <img src="${imageUrl}" alt="${image.category}" style="max-width: 200px; margin: 10px;">
                    <p>${image.description}</p>
                `;
                container.appendChild(imageElement);
            });
        });
    } else {
        container.innerHTML = '<p>No room images available for this hotel.</p>';
    }
}

// Event listener for the fetch hotel details button
document.getElementById('fetch-hotel-details').addEventListener('click', function () {
    const hotelId = window.env.HOTELID2;  // Replace with the actual hotelId you want to fetch

    // Sample hotelId, replace this with a dynamic value or prompt user input
    fetchHotelDetails(hotelId);  // Call the function to fetch hotel details
});

function displayAvailableRooms(rooms) {
        const availableRoomsContainer = document.getElementById('available-rooms');
        availableRoomsContainer.innerHTML = ''; // Clear previous rooms
        
        rooms.forEach(room => {
        
            if (room.available) {
                const roomDiv = document.createElement('div');
                roomDiv.innerHTML = `
                    <p>Room Number: ${room.roomNumber}</p>
                    <p>Room Type: ${room.roomType}</p>
                    <p>Clients in Room: ${room.clients.length}</p>
                    <button onclick="assignClientToRoom('${room._id}')">Assign Client to Room</button>
                `;
                availableRoomsContainer.appendChild(roomDiv);
            }
        });
    }

    // Function to assign a client to a room
async function assignClientToRoom(roomId) {
        const clientId = prompt('Enter the Client ID to assign to this room:');
        if (!clientId) return;

        try {
            const response = await fetch(`http://localhost:5000/assign-client-to-room`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ roomId, clientId })
            });

            const result = await response.json();
            if (response.status === 200) {
                alert('Client assigned to room!');
            } else {
                alert('Failed to assign client to room: ' + result.message);
            }
        } catch (error) {
            console.error('Error assigning client to room:', error);
            alert('Error assigning client to room');
        }
    }
        // Handle updating key status for clients
document.getElementById('update-key-status-form').addEventListener('submit', async (event) => {
    event.preventDefault();

    const roomId = document.getElementById('room-id').value;
    const clientId = document.getElementById('client-id').value;
    const hasKey = document.getElementById('has-key').checked;

    try {
        const response = await fetch('http://localhost:5000/update-key-status-hotel', {
            method: 'PUT',  // Use PUT for updating data
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                roomId,
                clientId,
                hasKey
            }),
        });

        const result = await response.json();
        if (response.status === 200) {
            alert('Key status updated successfully!');
        } else {
            alert('Error updating key status: ' + result.message);
        }
    } catch (error) {
        console.error('Error updating key status:', error);
        alert('Error updating key status');
    }
});

const roomsTableBody = document.querySelector('#rooms-table tbody');

// Function to format the room number to a clean numerical value
function formatRoomNumber(fullRoomNumber) {
    // Extract the human-readable part (the numeric part after the last "-")
    const parts = fullRoomNumber.split('-');
    const numericPart = parts[parts.length - 1]; // Get the last part (e.g., "R111")

    // Remove any non-numeric characters (just in case)
    const roomNumber = numericPart.replace(/[^\d]/g, '');

    // Return the room number as a zero-padded string (e.g., "001", "002")
    return roomNumber.padStart(3, '0');
}


const hotelIdB = "6844e2596e4bf672d629e738";
// Fetch rooms for the hotel
        fetch(`http://localhost:5000/hotel/${hotelId}/rooms`)
            .then(response => response.json())
            .then(rooms => {
                console.log("Data for rooms: ", rooms)
                roomsTableBody.innerHTML = ''; // Clear the table body before adding new rows
                rooms.forEach(room => {
                    const row = document.createElement('tr');
                    row.setAttribute('data-room-id', room._id); // Ensure row has data-room-id
                    // Use the formatRoomNumber function to display just the human-readable part of the room number
            const readableRoomNumber = formatRoomNumber(room.roomNumber);
            row.innerHTML = `
                <td><input type="text" value="${formatRoomNumber(room.roomNumber)}" class="room-number" readOnly /></td>
                <td><input type="number" value="${room.bedNumber}" class="bed-number" /></td>
                <td><input type="text" value="${room.level}" class="level" /></td>
                <td><input type="number" value="${room.peopleInRoom}" class="people-in-room" readonly /></td>
                <td><input type="number" value="${room.price}" class="room-price" /></td>
                <td>
                    <ul class="clients-list" id="clients-list-${room._id}"></ul>
                </td>
                <td>
                    <button class="add-client-btn" data-room-id="${room._id}">Add Client</button>
                    <button data-room-id="${room._id}" class="update-room-btn">Update</button>
                    <button data-room-id="${room._id}" class="delete-room-btn">Delete</button>
                    <button class="room-details-btn" data-room-id="${room._id}">Details</button>
                    <button class="room-images-btn-type" data-room-id="${room._id}">Room Images (Upload)</button> 
                    <button class="show-room-images-btn" data-room-id="${room._id}">Show Room Images</button>  <!-- New button to show room images -->
                    <button class="room-pictures-btn" data-room-id="${room._id}">Room Pictures</button> <!-- New button for room-specific images -->

                </td>
                <td>
                    <div class="room-details" id="room-details-${room._id}" style="display: none;">
                        <h3>Room Description</h3>
                        <p id="room-description-text-${room._id}"></p>
                        <h3>Room Equipment</h3>
                        <ul class="room-equipment-list" id="equipment-list-${room._id}"></ul>
                    </div>
                    <!-- This is the container for room images that will be shown when clicking "Show Room Images" -->
                    <div class="room-images-container" id="room-images-container-${room._id}" style="display: none;"></div>
                    <div class="room-pictures-container" id="room-pictures-container-${room._id}" style="display: none;"></div> <!-- Container for room pictures -->

                </td>
            `;
             roomsTableBody.appendChild(row);

                     // Room Images Button Logic
            const roomImagesBtn = row.querySelector('.room-images-btn-type');
            roomImagesBtn.addEventListener('click', () => {
                const roomId = room._id;
                openRoomImagesModal(roomId); // Open the modal for uploading images for this room
            });

          // Show Room Images Button Logic (Display images for the specific room type)
          const showRoomImagesBtn = row.querySelector('.show-room-images-btn');
            showRoomImagesBtn.addEventListener('click', () => {
                const roomId = room._id;
                showRoomImages(roomId); // Show the images for the specific room type
                
            });

             // Room Pictures Button Logic (Display images for the specific room with options to add/edit/delete)
             const roomPicturesBtn = row.querySelector('.room-pictures-btn');
roomPicturesBtn.addEventListener('click', () => {
    const roomId = room._id;

    // Get the container that holds the room images
    const roomPicturesContainer = document.getElementById(`room-pictures-container-${roomId}`);

    // Toggle visibility of the room images container
    if (roomPicturesContainer.style.display === 'block') {
        // If it's already visible, hide it
        roomPicturesContainer.style.display = 'none';
    } else {
        // If it's hidden, show it and fetch images
        showRoomPictures(roomId);
    }
});


            // Room Details Button Logic (toggle visibility of room details)
            const roomDetailsBtn = row.querySelector('.room-details-btn');
            roomDetailsBtn.addEventListener('click', () => {
                const detailsSection = row.querySelector('.room-details');
                const roomId = row.getAttribute('data-room-id'); // Get the room ID

                // Fetch the hotel data to get roomTypes
                fetch(`http://localhost:5000/get-hotel-details/${hotelIdB}`)
                    .then(response => response.json())
                    .then(hotel => {
                        // Find the room object based on roomId
                        const room = hotel.rooms.find(r => r._id === roomId);
                        if (!room) return; // Ensure room exists
                        
                        // Get the roomType (Single, Double, etc.)
                        const roomType = room.roomType;

                        // Find the corresponding roomType data from hotel.roomTypes
                        const roomTypeData = hotel.roomTypes.find(rt => rt.roomType === roomType);
                        if (!roomTypeData) return;  // If no matching roomType found, do nothing
                        
                        // Update room description and equipment list from roomTypes
                        const roomDescriptionElement = document.getElementById(`room-description-text-${roomId}`);
                        const equipmentListElement = document.getElementById(`equipment-list-${roomId}`);
                        
                        roomDescriptionElement.innerHTML = roomTypeData.roomDescription; // Update description
                        equipmentListElement.innerHTML = roomTypeData.roomEquipment.map(equipment => `
                            <li>
                                <strong>${equipment.equipment}:</strong> ${equipment.description}
                            </li>
                        `).join(''); // Update equipment list

                        // Toggle the visibility of the details section
                        if (detailsSection.style.display === 'none') {
                            detailsSection.style.display = 'block';
                            roomDetailsBtn.textContent = 'Hide Details'; 
                        } else {
                            detailsSection.style.display = 'none';
                            roomDetailsBtn.textContent = 'Details'; 
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching hotel data for room details:', error);
                        alert('Failed to fetch room data for details');
                    });
            });

           


           

            


                    // Handle add client functionality
                    const addClientBtn = row.querySelector('.add-client-btn');
                    addClientBtn.addEventListener('click', () => {
                        const roomId = room._id;
                        const securityCode = prompt("Enter client security code:");

                        if (securityCode) {
                            fetch(`http://localhost:5000/get-client-by-security-code-hotel?securityCode=${securityCode}`)
                                .then(response => response.json())
                                .then(clientData => {
                                    if (clientData && clientData.client) {
                                        const client = clientData.client;
                                        addClientToRoom(roomId, client);
                                    } else {
                                        alert('Client not found!');
                                    }
                                })
                                .catch(error => {
                                    console.error("Error fetching client by security code:", error);
                                    alert("Error fetching client. Please try again.");
                                });
                        }
                    });

                    // Fetch client details for this room
                    const clientIds = room.clients.map(client => client.clientId).join(',');
                    fetch(`http://localhost:5000/get-clients-details-hotel?clientIds=${clientIds}`)
                        .then(clientResponse => clientResponse.json())
                        .then(clientData => {
                            const clientsList = document.getElementById(`clients-list-${room._id}`);
                            room.clients.forEach(client => {
                                const clientDetails = clientData.clients.find(c => c._id.toString() === client.clientId.toString());
                                const clientItem = document.createElement('li');
                                if (clientDetails) {
                                    clientItem.innerHTML = `
                                        ${clientDetails.firstName} ${clientDetails.lastName} 
                                        <input type="checkbox" class="key-status-checkbox" data-room-id="${room._id}" data-client-id="${client.clientId}" ${client.hasKey ? 'checked' : ''}>
                                        <button class="remove-client-btn" data-room-id="${room._id}" data-client-id="${client.clientId}">Remove Client</button>
                                    `;
                                } else {
                                    clientItem.textContent = 'Unknown Client';
                                }
                                clientsList.appendChild(clientItem);

                                // Add event listener to checkbox to update the key status
                                const checkbox = clientItem.querySelector('.key-status-checkbox');
                                checkbox.addEventListener('change', () => {
                                    const hasKey = checkbox.checked;
                                    updateKeyStatus(room._id, client.clientId, hasKey);
                                });

                                // Add event listener to remove client button
                                const removeBtn = clientItem.querySelector('.remove-client-btn');
                                removeBtn.addEventListener('click', () => {
                                    removeClientFromRoom(room._id, client.clientId);
                                });
                            });
                        })
                        .catch(error => {
                            console.error("Error fetching client details:", error);
                            const clientsList = document.getElementById(`clients-list-${room._id}`);
                            const clientItem = document.createElement('li');
                            clientItem.textContent = 'Unknown Client';
                            clientsList.appendChild(clientItem);
                        });

                    // Event listener for updating the room
                    const updateBtn = row.querySelector('.update-room-btn');
                    updateBtn.addEventListener('click', () => {
                        updateRoomDetails(room._id);
                    });

                    // Event listener for deleting the room
                    const deleteBtn = row.querySelector('.delete-room-btn');
                    deleteBtn.addEventListener('click', () => {
                        deleteRoom(room._id);
                    });
                });
            })
            .catch(error => {
                console.error("Error fetching rooms:", error);
            });

            function openRoomImagesModal(roomId) {
    const modal = document.getElementById('roomImagesModal'); // Assuming you have this modal in your HTML
    const roomIdInput = modal.querySelector('#room-id-input');
    roomIdInput.value = roomId;  // Set the roomId in the hidden input field

    // Open the modal
    modal.style.display = 'block';

    // You can also dynamically load existing images for this room if needed
}

function showRoomImages(roomId) {
    const imagesContainer = document.getElementById(`room-images-container-${roomId}`);

    // Fetch room images for the hotel
    fetch(`http://localhost:5000/get-room-images/${hotelId}`)
        .then(response => response.json())
        .then(data => {
            // Clear the container before adding new images
            imagesContainer.innerHTML = '';

            // Find the room's type from the data
            fetch(`http://localhost:5000/hotel/${hotelId}/rooms`)
                .then(response => response.json())
                .then(rooms => {
                    const room = rooms.find(r => r._id === roomId);
                    if (!room) return;

                    const roomType = room.roomType; // Get the room type (e.g., 'Single', 'Double')

                    // Find the images associated with the room type
                    const roomImages = data.find(r => r.roomType === roomType);

                    if (roomImages && roomImages.images.length > 0) {
                        // If images exist, display them
                        roomImages.images.forEach((image) => {
                            const imgElement = document.createElement('img');
                            imgElement.src = `http://localhost:5000/${image.url}`;
                            imgElement.alt = image.description || `Image of ${roomType}`;
                            imgElement.classList.add('room-image');
                            imagesContainer.appendChild(imgElement);

                            // Create buttons for editing and deleting
                            const buttonContainer = document.createElement('div');
                            const editBtn = document.createElement('button');
                            const deleteBtnType = document.createElement('button');

                            editBtn.textContent = 'Edit';
                            deleteBtnType.textContent = 'Delete';
                            buttonContainer.appendChild(editBtn);
                            buttonContainer.appendChild(deleteBtnType);

                            // Add buttons next to the image
                            imagesContainer.appendChild(buttonContainer);

                            // Edit button functionality
                            editBtn.addEventListener('click', () => {
                                const newDescription = prompt('Enter new description:', image.description);
                                if (newDescription) {
                                    updateImageDescription(hotelId, roomType, image._id, newDescription);
                                }
                            });

                            // Delete button functionality
                            deleteBtnType.addEventListener('click', () => {
                                deleteImageType(hotelId, roomType, image._id, imagesContainer);
                            });
                        });
                    } else {
                        // No images for this room type, display the message
                        imagesContainer.innerHTML = 'No images found for this room type.';
                    }
                })
                .catch(error => {
                    console.error('Error fetching room data:', error);
                    alert('Failed to fetch room data for images');
                });

            // Show the images container
            imagesContainer.style.display = 'block';
        })
        .catch(error => {
            console.error('Error fetching images:', error);
            alert('Failed to fetch room images');
        });
}

// Function to update image description
function updateImageDescription(hotelId, roomType, imageId, newDescription) {
    fetch(`http://localhost:5000/update-room-image/${hotelId}/${roomType}/${imageId}`, {
        method: 'PUT',  // PUT request for updating
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ description: newDescription })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Image description updated successfully') {
            alert('Image description updated successfully!');
            // Optionally, you can refresh the images or update the description in the UI without reloading
        } else {
            alert('Failed to update image description');
        }
    })
    .catch(error => {
        console.error('Error updating image description:', error);
        alert('Error updating image description');
    });
}

// Function to delete image
function deleteImageType(hotelId, roomType, imageId, imagesContainer) {
    fetch(`http://localhost:5000/delete-room-image/${hotelId}/${roomType}/${imageId}`, {
        method: 'DELETE',  // DELETE request for removing the image
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Image deleted successfully') {
            alert('Image deleted successfully!');
            // Remove the image and its associated buttons from the UI
            const imgElement = imagesContainer.querySelector(`img[src*="${imageId}"]`);
            if (imgElement) {
                imgElement.remove();  // Remove the image
                imgElement.nextElementSibling.remove();  // Remove the buttons container
            }
        } else {
            alert('Failed to delete image');
        }
    })
    .catch(error => {
        console.error('Error deleting image:', error);
        alert('Error deleting image');
    });
}



// Function to show and manage room-specific images
function showRoomPictures(roomId) {
    // Get the container where images will be displayed
    const roomPicturesContainer = document.getElementById(`room-pictures-container-${roomId}`);
    roomPicturesContainer.innerHTML = ''; // Clear any previous content inside the container

    // Fetch the room details including the images
    fetch(`http://localhost:5000/room/${roomId}`)
        .then(response => response.json())
        .then(room => {
            console.log("Room Images Data: ", room);  // Log the room data to the console for debugging

            // Check if the room has images
            if (room.images && room.images.length > 0) {
                // Iterate through the images and create image elements
                room.images.forEach(image => {
                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('image-container');
                    
                    const img = document.createElement('img');
                    img.src = `http://localhost:5000/${image.url}`;
                    img.alt = image.description || 'Room Image';
                    img.classList.add('room-image');
                    
                    // Optional: Add image category and description
                    const category = document.createElement('p');
                    category.textContent = `Category: ${image.category || 'No category available'}`;
                    
                    const description = document.createElement('p');
                    description.textContent = `Description: ${image.description || 'No description available'}`;

                    // Create buttons for editing and deleting
                    const buttonContainer = document.createElement('div');
                    buttonContainer.classList.add('button-container');
                    
                    const editBtn = document.createElement('button');
                    const deleteBtn = document.createElement('button');

                    editBtn.textContent = 'Edit';
                    deleteBtn.textContent = 'Delete';

                    // Add buttons next to the image
                    buttonContainer.appendChild(editBtn);
                    buttonContainer.appendChild(deleteBtn);

                    // Add everything to the container
                    imageContainer.appendChild(img);
                    imageContainer.appendChild(category);
                    imageContainer.appendChild(description);
                    imageContainer.appendChild(buttonContainer);
                    roomPicturesContainer.appendChild(imageContainer);

                    // Edit button functionality
                    editBtn.addEventListener('click', () => {
                        const newDescription = prompt('Enter new description:', image.description);
                        if (newDescription) {
                            updateImageDescription(roomId, image._id, newDescription);
                        }
                    });

                    // Delete button functionality
                    deleteBtn.addEventListener('click', () => {
                        deleteImage(roomId, image._id, roomPicturesContainer);
                    });
                });
            } else {
                roomPicturesContainer.innerHTML = 'No images available for this room.';
            }

            // Add "Add Image" button below the images
            const addImageButton = document.createElement('button');
            addImageButton.textContent = 'Add Image';
            roomPicturesContainer.appendChild(addImageButton);

            // Open the upload modal when "Add Image" is clicked
            addImageButton.addEventListener('click', () => {
                openImageUploadModal(roomId);  // This should open a modal or form to upload an image
            });
        })
        .catch(error => {
            console.error('Error fetching room images:', error);
            roomPicturesContainer.innerHTML = 'Failed to load images.';
        });

    // Show the container if it's hidden
    roomPicturesContainer.style.display = 'block';
}


// Function to close the modal
function closeModal() {
    const modal = document.getElementById('uploadImageModal');
    modal.style.display = 'none'; // Close the modal
}
// Function to open the modal or form for uploading an image
function openImageUploadModal(roomId) {
    const modal = document.getElementById('uploadImageModal'); // Ensure you have this modal in your HTML
    const roomIdInput = modal.querySelector('#room-id-input');
    roomIdInput.value = roomId;  // Set the roomId in the hidden input field
    modal.style.display = 'block';  // Open the modal

    // Optionally, reset any previous form data
    const uploadForm = modal.querySelector('form');
    uploadForm.reset();  // Clear the form

    // Set up dynamic image upload behavior if needed
    const fileInput = modal.querySelector('#image-upload-input');
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            console.log('File selected:', file.name);
            // You can perform additional validation or show a preview of the selected image
        }
    });
}

// Handle image upload when the form is submitted
const uploadForm = document.getElementById('uploadImageForm');
uploadForm.addEventListener('submit', function (event) {
    event.preventDefault();  // Prevent the default form submission

    const roomId = document.getElementById('room-id-input').value;
    const formData = new FormData(uploadForm); // Gather form data including the image, category, and description

    fetch(`http://localhost:5000/upload-room-image/${roomId}`, {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json()) // Expecting JSON response
    .then(data => {
        if (data.message === "Category and description are required.") {
            alert('Please provide both category and description.');
        } else {
            console.log('Image uploaded successfully:', data); // Log the data
            closeModal(); // Close the modal after successful upload
            showRoomPictures(roomId); // Optionally refresh images
        }
    })
    .catch(error => {
        console.error('Error uploading image:', error);
        alert('Failed to upload image');
    });
});

// Function to update image description for a specific room
function updateImageDescription(roomId, imageId, newDescription) {
    fetch(`http://localhost:5000/update-room-image/${roomId}/${imageId}`, {
        method: 'PUT',  // PUT request for updating
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ description: newDescription })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Image description updated successfully') {
            alert('Image description updated successfully!');
        } else {
            alert('Failed to update image description');
        }
    })
    .catch(error => {
        console.error('Error updating image description:', error);
        alert('Error updating image description');
    });
}

// Function to delete image for a specific room
function deleteImage(roomId, imageId, picturesContainer) {
    fetch(`http://localhost:5000/delete-room-image/${roomId}/${imageId}`, {
        method: 'DELETE',  // DELETE request for removing the image
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Image deleted successfully') {
            alert('Image deleted successfully!');
            // Remove the image and its associated buttons from the UI
            const imgElement = picturesContainer.querySelector(`img[src*="${imageId}"]`);
            if (imgElement) {
                imgElement.remove();  // Remove the image
                imgElement.nextElementSibling.remove();  // Remove the buttons container
            }
        } else {
            alert('Failed to delete image');
        }
    })
    .catch(error => {
        console.error('Error deleting image:', error);
        alert('Error deleting image');
    });
}

function closeRoomImagesModal() {
    document.getElementById('roomImagesModal').style.display = 'none';
}



// Add Equipment Modal
function openAddEquipmentModal(roomId) {
    // Logic for opening a modal to add new equipment
}
function deleteRoom(roomId) {
            fetch(`http://localhost:5000/delete-room/${hotelId}/${roomId}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    alert('Room deleted successfully');
                    // Optionally remove the row from the table
                    const row = document.querySelector(`[data-room-id="${roomId}"]`);
                    row.remove();
                } else {
                    alert('Failed to delete room');
                }
            })
            .catch(error => {
                console.error('Error deleting room:', error);
                alert('Failed to delete room');
            });
        }

 function updateKeyStatus(roomId, clientId, hasKey) {
            // Update key status for the client in the room
            fetch(`http://localhost:5000/update-key-status/${roomId}/${clientId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ hasKey })
            })
            .then(response => {
                if (response.ok) {
                    console.log('Key status updated');
                } else {
                    alert('Failed to update key status');
                }
            })
            .catch(error => {
                console.error('Error updating key status:', error);
                alert('Failed to update key status');
            });
        }

// Function to add a client to the room
function addClientToRoom(roomId, client) {
    fetch(`http://localhost:5000/rooms/${roomId}/add-client-hotel`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ clientId: client._id })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Client added to the room!');
            // Reload or update the room clients list
            location.reload();  // Or refresh the client list manually if preferred
        } else {
            alert('Failed to add client to room.');
        }
    })
    .catch(error => {
        console.error('Error adding client to room:', error);
        alert('An error occurred. Please try again.');
    });
}

function updateRoomDetails(roomId) {
    const roomRow = document.querySelector(`[data-room-id="${roomId}"]`);
    
    if (!roomRow) {
        console.error(`Room with ID ${roomId} not found.`);
        return;
    }

    // Capture the values from the form inputs
    const updatedPrice = roomRow.querySelector('.room-price')?.value;
    const updatedRoomNumber = roomRow.querySelector('.room-number')?.value;
    const updatedBedNumber = roomRow.querySelector('.bed-number')?.value;
    const updatedLevel = roomRow.querySelector('.level')?.value;
    const updatedPeopleInRoom = roomRow.querySelector('.people-in-room')?.value;

    // Capture the existing clients (from the client list in the DOM)
    const clientItems = roomRow.querySelectorAll('.clients-list li');
    const clients = Array.from(clientItems).map(clientItem => {
        return {
            _id: clientItem.querySelector('input[type="checkbox"]').getAttribute('data-client-id'),
            clientId: clientItem.querySelector('input[type="checkbox"]').getAttribute('data-client-id'), // Ensure correct clientId
            name: clientItem.textContent.trim(),
            hasKey: clientItem.querySelector('input[type="checkbox"]').checked  // Retain key status
        };
    });

    // Check if all fields are filled in
    if (!updatedPrice || !updatedRoomNumber || !updatedBedNumber || !updatedLevel || !updatedPeopleInRoom) {
        alert('Please fill in all fields before updating the room.');
        return;
    }

    // Send the API request to update the room, including the price field and existing clients
    fetch(`http://localhost:5000/room/${roomId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            roomNumber: updatedRoomNumber,
            bedNumber: updatedBedNumber,
            level: updatedLevel,
            peopleInRoom: updatedPeopleInRoom,
            price: updatedPrice,  // Ensure price is included in the request
            clients: clients  // Include current clients with their details
        })
    })
    .then(response => {
        if (response.ok) {
            return response.json();  // Parse the response as JSON if it's successful
        } else {
            throw new Error('Failed to update room');
        }
    })
    .then(result => {
        alert('Room updated successfully');
        console.log('Updated room:', result);


        // After the update, make sure to re-render the client list from the result
        renderClientsList(roomId, result.room.clients);  // Fix to access clients within the room
        location.reload();
            })
    .catch(error => {
        console.error('Error updating room:', error);
        alert('Failed to update room');
    });
}

// Function to re-render the client list after updating the room
function renderClientsList(roomId, clients) {
    const roomRow = document.querySelector(`[data-room-id="${roomId}"]`);
    const clientsList = roomRow.querySelector('.clients-list');
    
    // Clear existing client list in the DOM
    clientsList.innerHTML = '';

    // Add the clients back to the list
    clients.forEach(client => {
        const clientItem = document.createElement('li');
        clientItem.innerHTML = `
            ${client.name}
            <input type="checkbox" class="key-status-checkbox" data-room-id="${roomId}" data-client-id="${client.clientId}" ${client.hasKey ? 'checked' : ''}>
            <button class="remove-client-btn" data-room-id="${roomId}" data-client-id="${client.clientId}">Remove Client</button>
        `;
        clientsList.appendChild(clientItem);

        // Add event listener to checkbox to update the key status
        const checkbox = clientItem.querySelector('.key-status-checkbox');
        checkbox.addEventListener('change', () => {
            const hasKey = checkbox.checked;
            updateKeyStatus(roomId, client.clientId, hasKey);
        });

        // Add event listener to remove client button
        const removeBtn = clientItem.querySelector('.remove-client-btn');
        removeBtn.addEventListener('click', () => {
            removeClientFromRoom(roomId, client.clientId);
        });
    });
}

// Function to update key status for a client
async function updateKeyStatus(roomId, clientId, hasKey) {
    try {
        const response = await fetch('http://localhost:5000/update-key-status-hotel', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                roomId,
                clientId,
                hasKey,
            }),
        });
        const result = await response.json();
        if (response.status === 200) {
            alert('Key status updated successfully!');
        } else {
            alert('Error updating key status: ' + result.message);
        }
    } catch (error) {
        console.error('Error updating key status:', error);
        alert('Error updating key status');
    }
}


// Function to remove a client from a room
async function removeClientFromRoom(roomId, clientId) {
    try {
        const response = await fetch('http://localhost:5000/remove-client-from-room-hotel', {  // Updated endpoint
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                roomId,
                clientId,
            }),
        });

        const result = await response.json();
        if (response.status === 200) {
            alert('Client removed from the room successfully!');
            // Optionally, you can update the room's client list here by removing the client from the UI
            const clientItem = document.querySelector(`button[data-room-id="${roomId}"][data-client-id="${clientId}"]`).closest('li');
            clientItem.remove();
        } else {
            alert('Error removing client: ' + result.message);
        }
    } catch (error) {
        console.error('Error removing client:', error);
        alert('Error removing client');
    }
}

        // Event listener for updating room details
// document.body.addEventListener('click', (e) => {
//             if (e.target && e.target.classList.contains('update-room-btn')) {
//                 const roomId = e.target.dataset.roomId;
//                 const roomNumber = document.querySelector(`.room-number[data-room-id="${roomId}"]`).value;
//                 const bedNumber = document.querySelector(`.bed-number[data-room-id="${roomId}"]`).value;
//                 const level = document.querySelector(`.level[data-room-id="${roomId}"]`).value;
//                 const peopleInRoom = document.querySelector(`.people-in-room[data-room-id="${roomId}"]`).value;

//                 // Update the room details
//                 fetch(`http://localhost:5000/room/${roomId}`, {
//                     method: 'PUT',
//                     headers: {
//                         'Content-Type': 'application/json',
//                     },
//                     body: JSON.stringify({ roomNumber, bedNumber, level, peopleInRoom }),
//                 })
//                 .then(response => response.json())
//                 .then(data => {
//                     alert('Room updated successfully');
//                     location.reload();  // Reload the page to show the updated data
//                 })
//                 .catch(error => console.error('Error updating room:', error));
//             }

//             if (e.target && e.target.classList.contains('delete-room-btn')) {
//                 const roomId = e.target.dataset.roomId;

//                 // Delete the room
//                 fetch(`http://localhost:5000/room/${roomId}`, { method: 'DELETE' })
//                     .then(response => response.json())
//                     .then(data => {
//                         alert('Room deleted successfully');
//                         location.reload();  // Reload the page to reflect changes
//                     })
//                     .catch(error => console.error('Error deleting room:', error));
//             }
//         });

        // Handle adding client to room
// Handle adding client to room
addClientForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const roomId = document.getElementById('room-id-add').value;
    const clientId = document.getElementById('client-id-add').value;

    fetch(`http://localhost:5000/room/${roomId}/add-client`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ clientId }),
    })
    .then(response => response.json())
    .then(data => {
        alert('Client added to room');
        location.reload();
    })
    .catch(error => console.error('Error adding client to room:', error));
});


 // Fetch facilities from the backend
 fetch(`http://localhost:5000/hotel/${hotelId}/facilities`)
            .then(response => response.json())
            .then(data => {
                console.log("Facillities Data: ", data)
                const facilitiesTableBody = document.querySelector('#facilities-table tbody');
                data.facilities.forEach(facility => {
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', facility._id);  // Set data-id for the row
                    row.innerHTML = `
                        <td>${facility.name}</td>
                        <td>${facility.description}</td>
                        <td>${facility.available ? 'Available' : 'Not Available'}</td>
                        <td>
                            <button class="edit-facility-btn" data-id="${facility._id}">Edit</button>
                            <button class="delete-facility-btn" data-id="${facility._id}">Delete</button>
                        </td>
                    `;
                    facilitiesTableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching facilities:', error));

        // Handle Add Facility Button
        document.getElementById('add-facility-btn').addEventListener('click', () => {
    // Ensure that the modal and form are present in the DOM
    const modal = document.getElementById('facility-modal');
    if (modal) {
        document.getElementById('facility-form').reset();
        document.getElementById('save-facility-btn').textContent = 'Save';
        document.getElementById('facility-id').value = '';  // Clear any existing facility ID for new addition
        modal.style.display = 'block'; // Show modal for adding a new facility
    }
});

document.getElementById('facility-form').addEventListener('submit', (event) => {
    event.preventDefault();
    const facilityId = document.getElementById('facility-id').value;

    const facilityUpdate = {
        name: document.getElementById('facility-name').value,
        description: document.getElementById('facility-description').value,
        available: document.getElementById('facility-status').checked
    };

    const method = facilityId ? 'PUT' : 'POST';  // Determine if it's an update or new facility
    const url = facilityId
        ? `http://localhost:5000/hotel/${hotelId}/facilities/${facilityId}`
        : `http://localhost:5000/hotel/${hotelId}/facilities`;

    fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(facilityUpdate),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert(facilityId ? 'Facility updated successfully!' : 'Facility added successfully!');

            location.reload();
            if (facilityId) {
                // Update the existing row in the table
                const row = document.querySelector(`tr[data-id='${facilityId}']`);
                if (row) {
                    // Update facility details in the row if the necessary elements exist
                    const nameElement = row.querySelector('.facility-name');
                    const descriptionElement = row.querySelector('.facility-description');
                    const statusElement = row.querySelector('.facility-status');
                    
                    if (nameElement) nameElement.textContent = facilityUpdate.name;
                    if (descriptionElement) descriptionElement.textContent = facilityUpdate.description;
                    if (statusElement) statusElement.textContent = facilityUpdate.available ? 'Available' : 'Not Available';
                } else {
                    console.error(`Row with facility ID ${facilityId} not found.`);
                }
            } else {
                // Create a new row for the new facility
                if (result.facility && result.facility._id) {
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', result.facility._id);
                    row.innerHTML = `
                        <td class="facility-name">${result.facility.name}</td>
                        <td class="facility-description">${result.facility.description}</td>
                        <td class="facility-status">${result.facility.available ? 'Available' : 'Not Available'}</td>
                        <td>
                            <button class="edit-facility-btn" data-id="${result.facility._id}">Edit</button>
                            <button class="delete-facility-btn" data-id="${result.facility._id}">Delete</button>
                        </td>
                    `;
                    document.querySelector('#facilities-table tbody').appendChild(row);
                } else {
                    alert('Error: No facility ID returned');
                }
            }

            // Hide the modal after the action is complete
            document.getElementById('facility-modal').style.display = 'none';
        } else {
            alert('Error saving facility');
        }
    })
    .catch(error => console.error('Error saving facility:', error));  // catch any errors during fetch
});

document.querySelector('#facilities-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-facility-btn')) {
        const facilityId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/facilities/${facilityId}`)
            .then(response => response.json())
            .then(facility => {
                document.getElementById('facility-name').value = facility.name;
                document.getElementById('facility-description').value = facility.description;
                document.getElementById('facility-status').checked = facility.available;
                document.getElementById('facility-id').value = facility._id;
                document.getElementById('save-facility-btn').textContent = 'Update'; // Change the button text to 'Update'



               // Show the modal
               document.getElementById('facility-modal').style.display = 'block';

            })
            .catch(err => {
                console.error('Error fetching facility:', err);
            });
    }
});

        // Handle Delete Facility
document.querySelector('#facilities-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-facility-btn')) {
                const facilityId = event.target.getAttribute('data-id');
                fetch(`http://localhost:5000/hotel/${hotelId}/facilities/${facilityId}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            alert('Facility deleted!');
                            console.log("Deleting facility with id:", facilityId);

                            // Select the row based on the facilityId and log it
                            const row = document.querySelector(`tr[data-id='${facilityId}']`);
                            console.log("Found row:", row);

                            // Check if the row exists before attempting to remove it
                            if (row) {
                                row.remove();  // Remove the row from the table
                            } else {
                                console.error(`Row with data-id="${facilityId}" not found in the DOM.`);
                            }
                        } else {
                            alert('Error deleting facility');
                        }
                    })
                    .catch(err => console.error("Error in delete request:", err));
            }
        });



    // Fetch roomServices from the backend
fetch(`http://localhost:5000/hotel/${hotelId}/room-services`)
    .then(response => response.json())
    .then(data => {
        console.log(data);
        const roomServicesTableBody = document.querySelector('#room-services-table tbody');
        data.roomServices.forEach(roomService => {
            const row = document.createElement('tr');
            row.setAttribute('data-id', roomService._id);  // Set data-id for the row
            row.innerHTML = `
                <td class="room-services-name">${roomService.name}</td>
                <td class="room-services-description">${roomService.description}</td>
                <td class="room-services-status">${roomService.available ? 'Available' : 'Not Available'}</td>
                <td>
                    <button class="edit-room-services-btn" data-id="${roomService._id}">Edit</button>
                    <button class="delete-room-services-btn" data-id="${roomService._id}">Delete</button>
                </td>
            `;
            roomServicesTableBody.appendChild(row);
        });
    })
    .catch(error => console.error('Error fetching roomServices:', error));

// Handle Add RoomServices Button
document.getElementById('add-room-services-btn').addEventListener('click', () => {
    document.getElementById('room-services-form').reset();
    document.getElementById('save-room-services-btn').textContent = 'Save';
    document.getElementById('room-services-modal').style.display = 'block';
});

// Handle Save RoomServices (for Add and Update)
document.getElementById('room-services-form').addEventListener('submit', (event) => {
    event.preventDefault(); // Prevent the form from submitting normally

    const roomServicesId = document.getElementById('room-services-id').value;  // Get the room service ID (if editing)
    const updatedRoomServices = {
        name: document.getElementById('room-services-name').value,
        description: document.getElementById('room-services-description').value,
        available: document.getElementById('room-services-status').checked,  // Ensure availability is a boolean
    };

    // If there's no room service ID, it's an Add operation
    const method = roomServicesId ? 'PUT' : 'POST';
    const url = roomServicesId
        ? `http://localhost:5000/hotel/${hotelId}/room-services/${roomServicesId}`
        : `http://localhost:5000/hotel/${hotelId}/room-services`;

        fetch(url, {
    method,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(updatedRoomServices),
})
.then(response => response.json())
.then(result => {
    if (result.success) {
        alert(roomServicesId ? 'Room Services updated successfully!' : 'Room Services saved successfully!');

        // If the room service was created (POST request), check that result.roomService exists
        if (roomServicesId) {
            const row = document.querySelector(`tr[data-id='${roomServicesId}']`);
            row.querySelector('.room-services-name').textContent = updatedRoomServices.name;
            row.querySelector('.room-services-description').textContent = updatedRoomServices.description;
            row.querySelector('.room-services-status').textContent = updatedRoomServices.available ? 'Available' : 'Not Available';
        } else {
            if (result.roomService && result.roomService._id) {  // Make sure result.roomService is not undefined
                const row = document.createElement('tr');
                row.setAttribute('data-id', result.roomService._id);
                row.innerHTML = `
                    <td class="room-services-name">${result.roomService.name}</td>
                    <td class="room-services-description">${result.roomService.description}</td>
                    <td class="room-services-status">${result.roomService.available ? 'Available' : 'Not Available'}</td>
                    <td>
                        <button class="edit-room-services-btn" data-id="${result.roomService._id}">Edit</button>
                        <button class="delete-room-services-btn" data-id="${result.roomService._id}">Delete</button>
                    </td>
                `;
                document.querySelector('#room-services-table tbody').appendChild(row);
            } else {
                alert('Error: No room service ID returned');
            }
        }

        // Close the modal after update
        document.getElementById('room-services-modal').style.display = 'none';
    } else {
        alert('Error saving room services');
    }
    })
    .catch(error => console.error('Error saving room services:', error));
});

// Handle Edit RoomServices
document.querySelector('#room-services-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-room-services-btn')) {
        const roomServicesId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/room-services/${roomServicesId}`)
            .then(response => response.json())
            .then(updateRoom => {
                console.log("update this: ", updateRoom)
                // Pre-fill the modal with the existing roomServices data
                document.getElementById('room-services-name').value = updateRoom.name;
                document.getElementById('room-services-description').value = updateRoom.description;
                document.getElementById('room-services-status').checked = updateRoom.available;

                // Set the hidden input value with the room service ID
                document.getElementById('room-services-id').value = updateRoom._id;

                // Change button text to indicate update action
                document.getElementById('save-room-services-btn').textContent = 'Update';

                // Show the modal
                document.getElementById('room-services-modal').style.display = 'block';
            })
            .catch(err => console.error("Error fetching room service data:", err));
    }
});

// Handle Delete RoomServices
document.querySelector('#room-services-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('delete-room-services-btn')) {
        const roomServicesId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/room-services/${roomServicesId}`, { method: 'DELETE' })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('RoomServices deleted!');
                    const row = document.querySelector(`tr[data-id='${roomServicesId}']`);
                    if (row) {
                        row.remove();  // Remove the row from the table
                    }
                } else {
                    alert('Error deleting roomServices');
                }
            })
            .catch(err => console.error("Error in delete request:", err));
    }
});



// Fetch amenities from the backend
// Fetch amenities from the backend
function fetchAmenities() {
            fetch(`http://localhost:5000/hotel/${hotelId}/amenities`)
                .then(response => response.json())
                .then(data => {
                    console.log("Amenities Data: ", data)
                    const amenitiesTableBody = document.querySelector('#amenities-table tbody');
                    amenitiesTableBody.innerHTML = ''; // Clear the existing table content
                    data.amenities.forEach(amenity => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', amenity._id);
                        row.innerHTML = `
                            <td class="amenity-name">${amenity.name}</td>
                            <td class="amenity-description">${amenity.description}</td>
                            <td class="amenity-included">${amenity.included ? 'Included' : 'Not Included'}</td>
                            <td>
                                <button class="edit-amenity-btn" data-id="${amenity._id}">Edit</button>
                                <button class="delete-amenity-btn" data-id="${amenity._id}">Delete</button>
                            </td>
                        `;
                        amenitiesTableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching amenities:', error));
        }

        // Call the fetchAmenities function when the page loads
        window.onload = fetchAmenities;

        // Handle Add Amenity Button
        document.getElementById('add-amenity-btn').addEventListener('click', () => {
            document.getElementById('amenity-form').reset();
            document.getElementById('save-amenity-btn').textContent = 'Save';
            document.getElementById('amenity-modal').style.display = 'block';
        });

        // Handle Edit Amenity Button Click
        document.querySelector('#amenities-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('edit-amenity-btn')) {
                const amenityId = event.target.getAttribute('data-id');

                // Fetch the amenity data by ID
                fetch(`http://localhost:5000/hotel/${hotelId}/amenities/${amenityId}`)
                    .then(response => response.json())
                    .then(data => {
                        const amenity = data.amenity;

                        // Populate the form with the existing amenity data
                        document.getElementById('amenity-id').value = amenity._id;
                        document.getElementById('amenity-name').value = amenity.name;
                        document.getElementById('amenity-description').value = amenity.description;
                        document.getElementById('amenity-included').checked = amenity.included;

                        // Change the button text to 'Update'
                        document.getElementById('save-amenity-btn').textContent = 'Update';

                        // Show the modal
                        document.getElementById('amenity-modal').style.display = 'block';
                    })
                    .catch(err => {
                        console.error('Error fetching amenity:', err);
                        alert('Error fetching amenity');
                    });
            }
        });

        // Handle the form submit for creating or updating an amenity
        document.getElementById('amenity-form').addEventListener('submit', (event) => {
    event.preventDefault();

    // Get the form data
    const amenityData = {
        name: document.getElementById('amenity-name').value,  // Get selected amenity name
        description: document.getElementById('amenity-description').value,
        included: document.getElementById('amenity-included').checked,
    };

    // Check if we are updating an existing amenity
    const amenityId = document.getElementById('amenity-id').value;
    const method = amenityId ? 'PUT' : 'POST';
    const url = amenityId
        ? `http://localhost:5000/hotel/${hotelId}/amenities/${amenityId}`
        : `http://localhost:5000/hotel/${hotelId}/amenities`;

    // Send the data to the backend
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(amenityData),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert(amenityId ? 'Amenity updated!' : 'Amenity added!');
            fetchAmenities(); // Refresh the list of amenities
            document.getElementById('amenity-modal').style.display = 'none';
        } else {
            alert('Error saving amenity');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving amenity');
    });
});


        // Handle Delete Amenity
        document.querySelector('#amenities-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-amenity-btn')) {
                const amenityId = event.target.getAttribute('data-id');
                const row = event.target.closest('tr');

                if (confirm('Are you sure you want to delete this amenity?')) {
                    fetch(`http://localhost:5000/hotel/${hotelId}/amenities/${amenityId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            alert('Amenity deleted successfully!');
                            row.remove();
                        } else {
                            alert('Error deleting amenity');
                        }
                    })
                    .catch(error => console.error('Error deleting amenity:', error));
                }
            }
        });
// Fetch events from the backend
fetch(`http://localhost:5000/hotel/${hotelId}/events`)
    .then(response => response.json())
    .then(data => {
        const eventsTableBody = document.querySelector('#events-table tbody');
        data.events.forEach(event => {
            const row = document.createElement('tr');
            row.setAttribute('data-id', event._id);
            row.innerHTML = `
                <td class="event-name">${event.eventName}</td>
                <td class="event-type">${event.eventType}</td>
                <td class="event-date">${new Date(event.date).toLocaleDateString()}</td>
                <td class="event-attendees">${event.attendees}</td>
                <td class="event-description">${event.eventDescription}</td>
                <td>
                    <button class="edit-event-btn" data-id="${event._id}">Edit</button>
                    <button class="delete-event-btn" data-id="${event._id}">Delete</button>
                </td>
            `;
            eventsTableBody.appendChild(row);
        });
    })
    .catch(error => console.error('Error fetching events:', error));

// Handle Add Event Button
document.getElementById('add-event-btn').addEventListener('click', () => {
    // Reset the form for creating a new event
    document.getElementById('event-form').reset();
    document.getElementById('save-event-btn').style.display = 'inline-block'; // Show save button
    document.getElementById('update-event-btn').style.display = 'none'; // Hide update button
    document.getElementById('event-modal').style.display = 'block'; // Show the modal
});

// Handle Create Event
document.getElementById('event-form').addEventListener('submit', (event) => {
    event.preventDefault(); // Prevent default form submission behavior
    
    const eventId = document.getElementById('event-id').value;

    if (eventId) {
        // If eventId exists, update the event using PUT method
        updateEvent(eventId);
    } else {
        // Otherwise, create a new event using POST method
        createEvent();
    }
});

// Handle Create Event (POST request)
function createEvent() {
    const eventName = document.getElementById('event-name').value;
    const eventType = document.getElementById('event-type').value;
    const eventDate = document.getElementById('event-date').value;
    const attendees = document.getElementById('event-attendees').value;
    const eventDescription = document.getElementById('event-description').value;

    const eventData = {
        eventName,
        eventType,
        date: new Date(eventDate),
        attendees: parseInt(attendees),
        eventDescription,
    };

    fetch(`http://localhost:5000/hotel/${hotelId}/events`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(eventData),
    })
    .then(response => response.json())
    .then(result => {
        if (result.message === 'Event created successfully') {
            alert('Event created successfully!');
            location.reload();  // Reload the page to reflect the new event
        } else {
            alert('Error creating event');
        }
    })
    .catch(error => {
        console.error('Error creating event:', error);
        alert('Error creating event');
    });
}

// Handle Update Event (PUT request)
function updateEvent(eventId) {
    const updatedEvent = {
        eventName: document.getElementById('event-name').value,
        eventType: document.getElementById('event-type').value,
        date: document.getElementById('event-date').value,
        attendees: document.getElementById('event-attendees').value,
        eventDescription: document.getElementById('event-description').value,
    };

    fetch(`http://localhost:5000/hotel/${hotelId}/events/${eventId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(updatedEvent),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Event updated successfully!');
            
            // Update the row in the table with the new event data
            const row = document.querySelector(`tr[data-id="${eventId}"]`);
            if (row) {
                row.querySelector('.event-name').textContent = updatedEvent.eventName;
                row.querySelector('.event-type').textContent = updatedEvent.eventType;
                row.querySelector('.event-date').textContent = new Date(updatedEvent.date).toLocaleDateString();
                row.querySelector('.event-attendees').textContent = updatedEvent.attendees;
                row.querySelector('.event-description').textContent = updatedEvent.eventDescription;
            }

            // Close the modal
            document.getElementById('event-modal').style.display = 'none';
        } else {
            alert('Error updating event');
        }
    })
    .catch(error => {
        console.error('Error updating event:', error);
        alert('Error updating event');
    });
}

// Handle Edit Event (Pre-fill the modal for editing)
document.querySelector('#events-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-event-btn')) {
        const eventId = event.target.getAttribute('data-id');
        const row = event.target.closest('tr');

        const eventName = row.querySelector('.event-name').textContent;
        const eventType = row.querySelector('.event-type').textContent;
        const eventDate = new Date(row.querySelector('.event-date').textContent).toISOString().split('T')[0]; // Format date
        const eventAttendees = row.querySelector('.event-attendees').textContent;
        const eventDescription = row.querySelector('.event-description').textContent;

        // Fill in the form with the existing event data
        document.getElementById('event-name').value = eventName;
        document.getElementById('event-type').value = eventType;
        document.getElementById('event-date').value = eventDate;
        document.getElementById('event-attendees').value = eventAttendees;
        document.getElementById('event-description').value = eventDescription;
        document.getElementById('event-id').value = eventId; // Set event ID for update

        document.getElementById('save-event-btn').style.display = 'none'; // Hide save button
        document.getElementById('update-event-btn').style.display = 'inline-block'; // Show update button
        
        // Show the modal for editing
        document.getElementById('event-modal').style.display = 'block';
    }
});

// Policies

// Fetch policies from the backend and display them dynamically
fetch(`http://localhost:5000/hotel/${hotelId}/policies`)
    .then(response => response.json())
    .then(data => {
        const policiesTableBody = document.querySelector('#policies-table tbody');
        
        if (data.policies && data.policies.length > 0) {
            data.policies.forEach(policy => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', policy._id); // Assuming each policy has a unique _id
                row.innerHTML = `
                    <td class="check-in-time">${policy.checkInTime}</td>
                    <td class="check-out-time">${policy.checkOutTime}</td>
                    <td class="pet-policy">${policy.petPolicy}</td>
                    <td class="cancellation-policy">${policy.cancellationPolicy}</td>
                    <td>
                        <button class="edit-policy-btn">Edit</button>
                        <button class="delete-policy-btn">Delete</button>
                    </td>
                `;
                policiesTableBody.appendChild(row);
            });
        } else {
            policiesTableBody.innerHTML = '<tr><td colspan="5">No policies available</td></tr>';
        }
    })
    .catch(error => console.error('Error fetching policies:', error));

// Handle Add Policy Button
document.getElementById('add-policy-btn').addEventListener('click', () => {
    // Reset the form for adding new policy
    document.getElementById('policy-form').reset();
    document.getElementById('save-policy-btn').style.display = 'inline-block'; // Show save button
    document.getElementById('update-policy-btn').style.display = 'none'; // Hide update button
    document.getElementById('policy-modal').style.display = 'block'; // Show the modal
});

// Handle form submission (Create or Update Policy)
document.getElementById('policy-form').addEventListener('submit', (event) => {
    event.preventDefault();

    // Get the button that was clicked (either save or update)
    const saveButton = document.getElementById('save-policy-btn');
    const updateButton = document.getElementById('update-policy-btn');

    // Check which button was clicked
    if (saveButton && saveButton.style.display === 'inline-block') {
        // If save button is visible, create a new policy
        createPolicy();
    } else if (updateButton && updateButton.style.display === 'inline-block') {
        // If update button is visible, update the existing policy
        const policyId = document.getElementById('policy-id').value;
        updatePolicy(policyId);
    }
});
function createPolicy() {
    const checkInTime = document.getElementById('check-in-time').value;
    const checkOutTime = document.getElementById('check-out-time').value;
    const petPolicy = document.getElementById('pet-policy').value;
    const cancellationPolicy = document.getElementById('cancellation-policy').value;

    // Wrap the policy data in an array of objects inside a "policies" key
    const policyData = {
        policies: [{
            checkInTime,
            checkOutTime,
            petPolicy,
            cancellationPolicy
        }]
    };

    fetch(`http://localhost:5000/hotel/${hotelId}/policies`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(policyData),  // Send the entire policies object with an array inside
    })
    .then(response => response.json())
    .then(result => {
        if (result.message === 'Policies added successfully!') {
            alert('Policy added successfully!');
            location.reload();  // Reload to show updated policies
        } else {
            alert('Error adding policy');
        }
    })
    .catch(error => {
        console.error('Error adding policy:', error);
        alert('Error adding policy');
    });
}


// Handle Update Policy (PUT request)
function updatePolicy(policyId) {
    const checkInTime = document.getElementById('check-in-time').value;
    const checkOutTime = document.getElementById('check-out-time').value;
    const petPolicy = document.getElementById('pet-policy').value;
    const cancellationPolicy = document.getElementById('cancellation-policy').value;

    // Construct the policy data object
    const updatedPolicyData = {
        checkInTime,
        checkOutTime,
        petPolicy,
        cancellationPolicy
    };

    fetch(`http://localhost:5000/hotel/${hotelId}/policies/${policyId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(updatedPolicyData)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Policy updated successfully!');
            location.reload();  // Reload to show updated policies
            document.getElementById('policy-modal').style.display = 'none'; // Hide the modal
        } else {
            alert('Error updating policy');
        }
    })
    .catch(error => {
        console.error('Error updating policy:', error);
        alert('Error updating policy');
    });
}
// Handle the "Edit" button click
document.querySelector('#policies-table tbody').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-policy-btn')) {
        const row = event.target.closest('tr');
        const policyId = row.getAttribute('data-id');  // Get the policy ID from the row
        const checkInTime = row.querySelector('.check-in-time').textContent;
        const checkOutTime = row.querySelector('.check-out-time').textContent;
        const petPolicy = row.querySelector('.pet-policy').textContent;
        const cancellationPolicy = row.querySelector('.cancellation-policy').textContent;

        // Pre-fill the form with the policy data
        document.getElementById('check-in-time').value = checkInTime;
        document.getElementById('check-out-time').value = checkOutTime;
        document.getElementById('pet-policy').value = petPolicy;
        document.getElementById('cancellation-policy').value = cancellationPolicy;
        document.getElementById('policy-id').value = policyId;  // Store the policy ID in a hidden field

        // Switch buttons for saving or updating
        document.getElementById('save-policy-btn').style.display = 'none'; // Hide save button
        document.getElementById('update-policy-btn').style.display = 'inline-block'; // Show update button
        document.getElementById('policy-modal').style.display = 'block'; // Show the modal
    }
});


// Handle the "Delete" button click
document.querySelector('#policies-table tbody').addEventListener('click', (event) => {
    if (event.target.classList.contains('delete-policy-btn')) {
        const row = event.target.closest('tr');
        const policyId = row.getAttribute('data-id');  // Get the policy ID from the row

        // Confirm deletion with the user
        if (confirm('Are you sure you want to delete this policy?')) {
            deletePolicy(policyId);
        }
    }
});

// Handle Delete Policy (DELETE request)
function deletePolicy(policyId) {
    fetch(`http://localhost:5000/hotel/${hotelId}/policies/${policyId}`, {
        method: 'DELETE',
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Policy deleted successfully!');
            location.reload();  // Reload to show updated policies
        } else {
            alert('Error deleting policy');
        }
    })
    .catch(error => {
        console.error('Error deleting policy:', error);
        alert('Error deleting policy');
    });
}


// payment --------------------------------


// Fetch current payment methods for the hotel
fetch(`http://localhost:5000/hotel/${hotelId}/payment-methods`)
    .then(response => response.json())
    .then(data => {
        const tableBody = document.querySelector('#payment-methods-table tbody');
        data.paymentMethods.forEach(method => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${method.method}</td>
                <td>${method.description}</td>
                <td><button class="delete-payment-method-btn">Delete</button></td>
            `;
            tableBody.appendChild(row);
        });
    })
    .catch(error => console.error('Error fetching payment methods:', error));

// Handle add payment method button
document.getElementById('add-payment-method-btn').addEventListener('click', () => {
    document.getElementById('payment-method-modal').style.display = 'block';
});

// Handle form submission to save a new payment method
document.getElementById('payment-method-form').addEventListener('submit', (event) => {
    event.preventDefault();
    const method = document.getElementById('method').value;
    const description = document.getElementById('description').value;

    fetch(`http://localhost:5000/hotel/${hotelId}/payment-methods`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ method, description })
    })
    .then(response => response.json())
    .then(result => {
        alert('Payment method added successfully!');
        location.reload(); // Refresh the list
    })
    .catch(error => console.error('Error adding payment method:', error));
});






// payment client

// Fetch available payment methods for the hotel and display them
fetch(`http://localhost:5000/hotel/${hotelId}/payment-methods`)
    .then(response => response.json())
    .then(data => {
        const paymentSelect = document.getElementById('payment-method');
        data.paymentMethods.forEach(method => {
            const option = document.createElement('option');
            option.value = method.method;
            option.textContent = method.description;
            paymentSelect.appendChild(option);
        });
    })
    .catch(error => console.error('Error fetching payment methods:', error));

// Handle Pay Now button click
document.getElementById('pay-now-btn').addEventListener('click', () => {
    const paymentMethod = document.getElementById('payment-method').value;

    if (paymentMethod) {
        makePayment(paymentMethod);
    } else {
        alert('Please choose a payment method');
    }
});

// Function to process the payment
function makePayment(paymentMethod) {
    const bookingData = {
        customerId: 'customer123',  // Example customer ID
        paymentMethod,
        paymentStatus: 'pending',  // Set status as pending initially
        amount: 100,  // Example amount
    };

    fetch(`http://localhost:5000/hotel/${hotelId}/booking`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(bookingData)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Payment successful');
            updatePaymentStatus(result.bookingId, 'paid');
        } else {
            alert('Payment failed');
        }
    })
    .catch(error => {
        console.error('Error processing payment:', error);
        alert('Error processing payment');
    });
}

// Function to update the payment status once payment is successful
function updatePaymentStatus(bookingId, status) {
    fetch(`http://localhost:5000/hotel/${hotelId}/booking/${bookingId}/payment-status`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ status })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Payment status updated');
        } else {
            alert('Error updating payment status');
        }
    })
    .catch(error => console.error('Error updating payment status:', error));
}

// Fetch bookings data from your backend API
fetch(`http://localhost:5000/hotel/${hotelId}/bookings`)
        .then(response => response.json())
        .then(data => {
            const bookingListContainer = document.getElementById('booking-list');

            // Iterate over the bookings and display them
            data.bookings.forEach(booking => {
                console.log(`Booking ID: ${booking._id}, Payment Status: ${booking.paymentStatus}`);

                // Create a div element for each booking
                const bookingElement = document.createElement('div');
                bookingElement.classList.add('booking');

                // Set the payment status class based on the payment status
                let paymentStatusClass = '';
                let paymentStatusText = '';

                if (booking.paymentStatus === 'paid') {
                    paymentStatusClass = 'paid';
                    paymentStatusText = 'Payment Successful';
                } else if (booking.paymentStatus === 'pending') {
                    paymentStatusClass = 'pending';
                    paymentStatusText = 'Payment Pending';
                } else if (booking.paymentStatus === 'failed') {
                    paymentStatusClass = 'failed';
                    paymentStatusText = 'Payment Failed';
                }

                // Append booking details to the booking element
                bookingElement.innerHTML = `
                    <div class="booking-id">Booking ID: ${booking._id}</div>
                    <div class="status ${paymentStatusClass}">${paymentStatusText}</div>
                `;

                // Append the booking element to the booking list container
                bookingListContainer.appendChild(bookingElement);
            });
        })
        .catch(error => {
            console.error('Error fetching bookings:', error);
            // Display a message if there's an error fetching the data
            document.getElementById('booking-list').innerHTML = 'Error loading bookings.';
        });
    </script>
    <!-- Fetch emergency contacts from the backend -->
    <script>
        // Fetch emergency contacts
        fetch(`http://localhost:5000/hotel/${hotelId}/emergency-contacts`)
            .then(response => response.json())
            .then(data => {
                const contactsTableBody = document.querySelector('#emergency-contacts-table tbody');
                if (data.success && data.contacts) {
                    data.contacts.forEach(contact => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', contact._id);
                        row.innerHTML = `
                            <td class="contact-name">${contact.name}</td>
                            <td class="contact-number">${contact.contactNumber}</td>
                            <td>
                                <button class="edit-contact-btn" data-id="${contact._id}">Edit</button>
                                <button class="delete-contact-btn" data-id="${contact._id}">Delete</button>
                            </td>
                        `;
                        contactsTableBody.appendChild(row);
                    });
                } else {
                    console.error('Failed to load emergency contacts:', data.message);
                }
            })
            .catch(error => console.error('Error fetching emergency contacts:', error));
    
  // Handle Add Emergency Contact Button
  document.getElementById('add-emergency-contact-btn').addEventListener('click', () => {
        // Clear form fields for new contact and show 'Save' button
        document.getElementById('contact-id').value = '';  // Reset the hidden contactId field
        document.getElementById('contact-name').value = '';
        document.getElementById('contact-number').value = '';
        document.getElementById('save-contact-btn').style.display = 'inline-block'; // Show 'Save'
        document.getElementById('save-contact-btn').textContent = 'Save'; // Set text to 'Save'
        document.getElementById('emergency-contact-modal').style.display = 'block';
    });



    // Function to Create Emergency Contact (POST request)
    function createEmergencyContact(data) {
        fetch(`http://localhost:5000/hotel/${hotelId}/emergency-contacts`, {
            method: 'POST',  // Using POST to create a new contact
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            // Log the full response for debugging
            console.log('Create Contact Response:', result);

            if (result.success) {
                const contact = result.emergencyContact;  // Checking for emergencyContact

                // If the contact is found, update the table
                if (contact) {
                    alert('Emergency contact saved!');
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', contact._id);  // Using _id if it's available
                    row.innerHTML = `
                        <td class="contact-name">${contact.name}</td>
                        <td class="contact-number">${contact.contactNumber}</td>
                        <td>
                            <button class="edit-contact-btn" data-id="${contact._id}">Edit</button>
                            <button class="delete-contact-btn" data-id="${contact._id}">Delete</button>
                        </td>
                    `;
                    document.querySelector('#emergency-contacts-table tbody').appendChild(row);
                    document.getElementById('emergency-contact-modal').style.display = 'none';
                } else {
                    console.error('Error: Emergency contact object not found in response:', result);
                    alert('Error: Emergency contact not found in response');
                }
            } else {
                alert('Error saving emergency contact');
            }
        })
        .catch(error => {
            console.error('Error saving emergency contact:', error);
            alert('Error saving emergency contact');
        });
    }

    // Function to Update Emergency Contact (PUT request)
    function updateEmergencyContact(contactId, data) {
        fetch(`http://localhost:5000/hotel/${hotelId}/emergency-contacts/${contactId}`, {
            method: 'PUT',  // Using PUT here to update an existing contact
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Emergency contact updated successfully!');

                // Update the table row with the new data
                const row = document.querySelector(`tr[data-id="${contactId}"]`);
                row.querySelector('.contact-name').textContent = data.name;
                row.querySelector('.contact-number').textContent = data.contactNumber;

                // Close the modal
                document.getElementById('emergency-contact-modal').style.display = 'none';
            } else {
                alert('Error updating contact');
            }
        })
        .catch(error => {
            console.error('Error updating emergency contact:', error);
            alert('Error updating emergency contact');
        });
    }

   // Handle Edit Emergency Contact
document.querySelector('#emergency-contacts-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-contact-btn')) {
        const contactId = event.target.getAttribute('data-id');
        const row = event.target.closest('tr');

        // Retrieve the current contact details from the table row
        const contactName = row.querySelector('.contact-name').textContent;
        const contactNumber = row.querySelector('.contact-number').textContent;

        // Populate the form with the existing contact data
        document.getElementById('contact-id').value = contactId;  // Set the contactId in the form
        document.getElementById('contact-name').value = contactName;
        document.getElementById('contact-number').value = contactNumber;

        // Show 'Update' button instead of 'Save'
        document.getElementById('save-contact-btn').style.display = 'inline-block';
        document.getElementById('save-contact-btn').textContent = 'Update';

        // Show the modal for editing
        document.getElementById('emergency-contact-modal').style.display = 'block';
    }
});

// Handle Save or Update Emergency Contact (on form submit)
document.getElementById('emergency-contact-form').addEventListener('submit', (event) => {
    event.preventDefault();

    const contactId = document.getElementById('contact-id').value;  // Get contactId from form
    const contactName = document.getElementById('contact-name').value;
    const contactNumber = document.getElementById('contact-number').value;

    const data = {
        name: contactName,
        contactNumber: contactNumber
    };

    if (contactId) {
        // Update the contact (PUT request)
        updateEmergencyContact(contactId, data);
    } else {
        // Create a new contact (POST request)
        createEmergencyContact(data);
    }
});
        // Handle Delete Emergency Contact
        document.querySelector('#emergency-contacts-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-contact-btn')) {
                const contactId = event.target.getAttribute('data-id');
                const row = event.target.closest('tr');
    
                if (confirm('Are you sure you want to delete this contact?')) {
                    fetch(`http://localhost:5000/hotel/${hotelId}/emergency-contacts/${contactId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            alert('Emergency contact deleted successfully!');
                            row.remove();
                        } else {
                            alert('Error deleting contact');
                        }
                    })
                    .catch(error => console.error('Error deleting emergency contact:', error));
                }
            }
        });
    </script>
    <script>
        // Fetch alerts
// Fetch alerts
fetch(`http://localhost:5000/hotel/${hotelId}/alerts`)
    .then(response => response.json())
    .then(data => {
        const alertsTableBody = document.querySelector('#alerts-table tbody');
        if (data.success && data.alerts) {
            data.alerts.forEach(alert => {
                // Convert the date to a human-readable format
                const formattedDate = new Date(alert.date).toLocaleString();

                const row = document.createElement('tr');
                row.setAttribute('data-id', alert._id);
                row.innerHTML = `
                    <td class="alert-type">${alert.type}</td>
                    <td class="alert-message">${alert.message}</td>
                    <td class="alert-date">${formattedDate}</td>
                    <td>
                        <button class="edit-alert-btn" data-id="${alert._id}">Edit</button>
                        <button class="delete-alert-btn" data-id="${alert._id}">Delete</button>
                    </td>
                `;
                alertsTableBody.appendChild(row);
            });
        } else {
            console.error('Failed to load alerts:', data.message);
        }
    })
    .catch(error => console.error('Error fetching alerts:', error));


    document.getElementById('add-alert-btn').addEventListener('click', () => {
    // Clear form fields for new alert and show 'Save' button
    document.getElementById('alert-id').value = '';  // Reset the hidden alertId field
    document.getElementById('alert-type').value = '';
    document.getElementById('alert-message').value = '';
    document.getElementById('save-alert-btn').style.display = 'inline-block'; // Show 'Save'
    document.getElementById('save-alert-btn').textContent = 'Save'; // Set text to 'Save'
    document.getElementById('alert-modal').style.display = 'block';
});
// Avoid using `alert` as a variable or function name
const alertMessage = "Some message"; // Rename this to avoid confusion with built-in alert


// Function to Create Alert (POST request)
function createAlert(data) {
    fetch(`http://localhost:5000/hotel/${hotelId}/alerts`, {
        method: 'POST',  // Using POST to create a new alert
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        // Log the full response for debugging
        console.log('Create Alert Response:', result);

        if (result.success) {
            const createdAlert = result.alert;  // Checking for the alert object

            // If the alert is found, update the table
            if (createdAlert) {
                alert('Alert saved!');
                const formattedDate = new Date(createdAlert.date).toLocaleString(); // Format date

                const row = document.createElement('tr');
                row.setAttribute('data-id', createdAlert._id);  // Using _id if it's available
                row.innerHTML = `
                    <td class="alert-type">${createdAlert.type}</td>
                    <td class="alert-message">${createdAlert.message}</td>
                    <td class="alert-date">${formattedDate}</td> <!-- Display formatted date -->
                    <td>
                        <button class="edit-alert-btn" data-id="${createdAlert._id}">Edit</button>
                        <button class="delete-alert-btn" data-id="${createdAlert._id}">Delete</button>
                    </td>
                `;
                document.querySelector('#alerts-table tbody').appendChild(row);
                document.getElementById('alert-modal').style.display = 'none';
            } else {
                console.error('Error: Alert object not found in response:', result);
                alert('Error: Alert not found in response');
            }
        } else {
            alert('Error saving alert');
        }
    })
    .catch(error => {
        console.error('Error saving alert:', error);
        alert('Error saving alert');
    });
}

// Function to Update Alert (PUT request)
function updateAlert(alertId, data) {
    fetch(`http://localhost:5000/hotel/${hotelId}/alerts/${alertId}`, {
        method: 'PUT',  // Using PUT here to update an existing alert
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Alert updated successfully!');

            // Update the table row with the new data
            const row = document.querySelector(`tr[data-id="${alertId}"]`);
            row.querySelector('.alert-type').textContent = data.type;
            row.querySelector('.alert-message').textContent = data.message;

            // Update the date in the table (formatted)
            const formattedDate = new Date(result.alert.date).toLocaleString();  // Use the updated date
            row.querySelector('.alert-date').textContent = formattedDate;

            // Close the modal
            document.getElementById('alert-modal').style.display = 'none';
        } else {
            alert('Error updating alert');
        }
    })
    .catch(error => {
        console.error('Error updating alert:', error);
        alert('Error updating alert');
    });
}

// Handle Save or Update Alert (on form submit)
document.getElementById('alert-form').addEventListener('submit', (event) => {
    event.preventDefault();

    const alertId = document.getElementById('alert-id').value;  // Get alertId from form
    const alertType = document.getElementById('alert-type').value;
    const alertMessage = document.getElementById('alert-message').value;

    const data = {
        type: alertType,
        message: alertMessage
    };

    if (alertId) {
        // Update the alert (PUT request)
        updateAlert(alertId, data);
    } else {
        // Create a new alert (POST request)
        createAlert(data);
    }
});


// Handle Edit Alert
document.querySelector('#alerts-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-alert-btn')) {
        const alertId = event.target.getAttribute('data-id');
        const row = event.target.closest('tr');

        // Retrieve the current alert details from the table row
        const alertType = row.querySelector('.alert-type').textContent;
        const alertMessage = row.querySelector('.alert-message').textContent;

        // Populate the form with the existing alert data
        document.getElementById('alert-id').value = alertId;  // Set the alertId in the form
        document.getElementById('alert-type').value = alertType;
        document.getElementById('alert-message').value = alertMessage;

        // Show 'Update' button instead of 'Save'
        document.getElementById('save-alert-btn').style.display = 'inline-block';
        document.getElementById('save-alert-btn').textContent = 'Update';

        // Show the modal for editing
        document.getElementById('alert-modal').style.display = 'block';
    }
});

// Handle Delete Alert
document.querySelector('#alerts-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('delete-alert-btn')) {
        const alertId = event.target.getAttribute('data-id');
        const row = event.target.closest('tr');

        if (confirm('Are you sure you want to delete this alert?')) {
            fetch(`http://localhost:5000/hotel/${hotelId}/alerts/${alertId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('Alert deleted successfully!');
                    row.remove();
                } else {
                    alert('Error deleting alert');
                }
            })
            .catch(error => console.error('Error deleting alert:', error));
        }
    }
});

    </script>
    <script>
     // Fetch staff members
     function fetchStaffMembers() {
            fetch(`http://localhost:5000/hotel/${hotelId}/staff`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.staffMembers) {
                        const staffTableBody = document.querySelector('#staff-table tbody');
                        staffTableBody.innerHTML = ''; // Clear current table rows

                        data.staffMembers.forEach(staff => {
                            const row = document.createElement('tr');
                            row.setAttribute('data-id', staff._id);
                            row.innerHTML = `
                                <td class="staff-name">${staff.name}</td>
                                <td class="staff-role">${staff.role}</td>
                                <td class="staff-contact-info">${staff.contactInfo}</td>
                                <td class="staff-shift">${staff.shift}</td>
                                <td class="staff-status">${staff.status}</td>
                                <td>
                                    <button class="edit-staff-btn" data-id="${staff._id}">Edit</button>
                                    <button class="delete-staff-btn" data-id="${staff._id}">Delete</button>
                                </td>
                            `;
                            staffTableBody.appendChild(row);
                        });
                    } else {
                        console.error('Failed to load staff members:', data.message);
                    }
                })
                .catch(error => console.error('Error fetching staff members:', error));
        }

        // Show modal for adding staff
        document.getElementById('add-staff-btn').addEventListener('click', () => {
            document.getElementById('staff-form').reset();
            document.getElementById('staff-id').value = ''; // Reset hidden staffId
            document.getElementById('modal-title').textContent = 'Add New Staff';
            document.getElementById('save-staff-btn').textContent = 'Save';
            document.getElementById('staff-modal').style.display = 'block';
        });

        // Show modal for editing staff
        document.querySelector('#staff-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('edit-staff-btn')) {
                const staffId = event.target.getAttribute('data-id');
                const row = event.target.closest('tr');
                const staffName = row.querySelector('.staff-name').textContent;
                const staffRole = row.querySelector('.staff-role').textContent;
                const staffContactInfo = row.querySelector('.staff-contact-info').textContent;
                const staffShift = row.querySelector('.staff-shift').textContent;
                const staffStatus = row.querySelector('.staff-status').textContent;

                document.getElementById('staff-id').value = staffId;
                document.getElementById('staff-name').value = staffName;
                document.getElementById('staff-role').value = staffRole;
                document.getElementById('staff-contact-info').value = staffContactInfo;
                document.getElementById('staff-shift').value = staffShift;
                document.getElementById('staff-status').value = staffStatus;

                document.getElementById('modal-title').textContent = 'Edit Staff';
                document.getElementById('save-staff-btn').textContent = 'Update';
                document.getElementById('staff-modal').style.display = 'block';
            }
        });

        // Close the modal
        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('staff-modal').style.display = 'none';
        });

        // Handle staff form submission (Save or Update)
        document.getElementById('staff-form').addEventListener('submit', (event) => {
            event.preventDefault();
            const staffId = document.getElementById('staff-id').value;
            const staffData = {
                name: document.getElementById('staff-name').value,
                role: document.getElementById('staff-role').value,
                contactInfo: document.getElementById('staff-contact-info').value,
                shift: document.getElementById('staff-shift').value,
                status: document.getElementById('staff-status').value,
            };

            if (staffId) {
                updateStaffMember(staffId, staffData);
            } else {
                createStaffMember(staffData);
            }
        });

        // Function to create a new staff member (POST)
        function createStaffMember(data) {
            fetch(`http://localhost:5000/hotel/${hotelId}/staff`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('Staff member added!');
                    fetchStaffMembers();
                    document.getElementById('staff-modal').style.display = 'none';
                } else {
                    alert('Error adding staff member');
                }
            })
            .catch(error => console.error('Error adding staff member:', error));
        }

        // Function to update a staff member (PUT)
        function updateStaffMember(staffId, data) {
            fetch(`http://localhost:5000/hotel/${hotelId}/staff/${staffId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('Staff member updated!');
                    fetchStaffMembers();
                    document.getElementById('staff-modal').style.display = 'none';
                } else {
                    alert('Error updating staff member');
                }
            })
            .catch(error => console.error('Error updating staff member:', error));
        }

        // Function to delete a staff member (DELETE)
        document.querySelector('#staff-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-staff-btn')) {
                const staffId = event.target.getAttribute('data-id');
                const row = event.target.closest('tr');

                if (confirm('Are you sure you want to delete this staff member?')) {
                    fetch(`http://localhost:5000/hotel/${hotelId}/staff/${staffId}`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            alert('Staff member deleted!');
                            row.remove();
                        } else {
                            alert('Error deleting staff member');
                        }
                    })
                    .catch(error => console.error('Error deleting staff member:', error));
                }
            }
        });

        // Initialize by fetching staff members when the page loads
        fetchStaffMembers();
    </script>
    <script>
// Get elements
const addOfferButton = document.getElementById('addOfferButton');
const addOfferForm = document.getElementById('addOfferForm');
const addOfferFormContainer = document.getElementById('addOfferFormContainer');
const formSubmitButton = document.getElementById('formSubmitButton');
const specialOffersList = document.getElementById('specialOffersList');
let editingOfferId = null;  // To track which offer is being edited

// Event listener for Add Offer button
addOfferButton.addEventListener('click', function() {
    // Show the form for adding a new offer
    addOfferFormContainer.style.display = 'block';
    addOfferButton.style.display = 'none';  // Hide the Add Offer button
    addOfferForm.reset();  // Reset the form in case there was previous data

    // Change the form title and button text for adding a new offer
    document.getElementById('formTitle').innerText = "Add New Special Offer";
    formSubmitButton.innerText = "Add Offer";
    editingOfferId = null;  // Reset the editing offer ID
});

// Event listener for adding a new offer or editing an existing one
addOfferForm.addEventListener('submit', function(e) {
    e.preventDefault();

    const offerName = document.getElementById('offerName').value;
    const description = document.getElementById('description').value;
    const discountPercentage = document.getElementById('discountPercentage').value;
    const validFrom = document.getElementById('validFrom').value;
    const validUntil = document.getElementById('validUntil').value;

    const newOffer = {
        offerName,
        description,
        discountPercentage: Number(discountPercentage),
        validFrom,
        validUntil
    };

    if (editingOfferId) {
        // Update existing offer
        axios.put(`http://localhost:5000/hotel/${hotelId}/special-offers/${editingOfferId}`, newOffer)
    .then(response => {
        console.log('Offer updated successfully:', response);

        // Re-fetch the special offers after the update
        fetchSpecialOffers();  // This will refresh the list with the latest data

        addOfferFormContainer.style.display = 'none';
        addOfferButton.style.display = 'block';
        editingOfferId = null;
    })
    .catch(error => {
        console.error('Error updating special offer:', error);
    });
    } else {
        // Add new offer
        axios.post(`http://localhost:5000/hotel/${hotelId}/special-offers`, newOffer)
            .then(response => {
                const offer = response.data.specialOffer;
                addOfferToList(offer);  // Add new offer to the list
                addOfferFormContainer.style.display = 'none';  // Hide form after submission
                addOfferButton.style.display = 'block';  // Show the Add Offer button again
            })
            .catch(error => {
                console.error('Error adding special offer:', error);
            });
    }
});

// Fetch and display current special offers
function fetchSpecialOffers() {
    axios.get(`http://localhost:5000/hotel/${hotelId}/special-offers`)
        .then(response => {
            const offers = response.data.specialOffers;
            specialOffersList.innerHTML = '';  // Clear current list
            offers.forEach(offer => {
                addOfferToList(offer);
            });
        })
        .catch(error => {
            console.error('Error fetching special offers:', error);
        });
}

// Add offer to the list in the UI
function addOfferToList(offer) {
    const listItem = document.createElement('li');
    listItem.id = `offer-${offer._id}`;  // Ensure the list item ID matches the offer's _id
    listItem.innerHTML = `
        <h3>${offer.offerName}</h3>
        <p>${offer.description}</p>
        <p><strong>Discount:</strong> ${offer.discountPercentage}%</p>
        <p><strong>Valid From:</strong> ${new Date(offer.validFrom).toLocaleDateString()}</p>
        <p><strong>Valid Until:</strong> ${new Date(offer.validUntil).toLocaleDateString()}</p>
        <button onclick="editSpecialOffer('${offer._id}')">Edit</button>
        <button onclick="deleteSpecialOffer('${offer._id}')">Delete</button>
    `;
    specialOffersList.appendChild(listItem);
}


function editSpecialOffer(offerId) {
    console.log('Editing Offer ID:', offerId);  // Check the offer ID being passed

    axios.get(`http://localhost:5000/hotel/${hotelId}/special-offers`)
        .then(response => {
            const offer = response.data.specialOffers.find(o => o._id === offerId);
            console.log('Fetched Offer:', offer);  // Check the offer data

            if (offer) {
                document.getElementById('offerName').value = offer.offerName;
                document.getElementById('description').value = offer.description;
                document.getElementById('discountPercentage').value = offer.discountPercentage;
                document.getElementById('validFrom').value = new Date(offer.validFrom).toISOString().split('T')[0];
                document.getElementById('validUntil').value = new Date(offer.validUntil).toISOString().split('T')[0];

                editingOfferId = offerId;  // Set editing state
                addOfferFormContainer.style.display = 'block';
                addOfferButton.style.display = 'none';
                document.getElementById('formTitle').innerText = "Update Special Offer";
                formSubmitButton.innerText = "Update Offer";
            }
        })
        .catch(error => {
            console.error('Error fetching special offer for editing:', error);
        });
}



function updateOfferInList(updatedOffer) {
    // Check for the list item by the new ID, as the offer may have been updated with a new ID
    const listItem = document.getElementById(`offer-${updatedOffer._id}`);
    console.log('List item:', listItem);  // Log to verify if the item is found
    
    if (listItem) {
        // Update the list item with the new details
        listItem.innerHTML = `
            <h3>${updatedOffer.offerName}</h3>
            <p>${updatedOffer.description}</p>
            <p><strong>Discount:</strong> ${updatedOffer.discountPercentage}%</p>
            <p><strong>Valid From:</strong> ${new Date(updatedOffer.validFrom).toLocaleDateString()}</p>
            <p><strong>Valid Until:</strong> ${new Date(updatedOffer.validUntil).toLocaleDateString()}</p>
            <button onclick="editSpecialOffer('${updatedOffer._id}')">Edit</button>
            <button onclick="deleteSpecialOffer('${updatedOffer._id}')">Delete</button>
        `;
    } else {
        console.error('List item for the offer not found, possibly due to incorrect ID');
        console.log('Updated Offer:', updatedOffer);
    }
}




// Delete special offer
function deleteSpecialOffer(offerId) {
    axios.delete(`http://localhost:5000/hotel/${hotelId}/special-offers/${offerId}`)
        .then(response => {
            // Remove the offer from the list in the UI
            const listItem = document.querySelector(`#specialOffersList li button[onclick*="${offerId}"]`).parentElement;
            specialOffersList.removeChild(listItem);
        })
        .catch(error => {
            console.error('Error deleting special offer:', error);
        });
}

// Fetch offers when the page loads
fetchSpecialOffers();

    </script>
    
    <script>
    

    document.getElementById('roomImageUploadForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const roomId = document.getElementById('room-id-input').value;

    fetch(`http://localhost:5000/upload-room-image/${hotelId}/${roomId}`, {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            console.log('Image uploaded successfully for the room:', data);
            closeRoomImagesModal();
        } else {
            console.error('Error in server response:', data);
        }
    })
    .catch(error => {
        console.error('Error uploading image for the room:', error);
    });
});
function closeRoomTypeImagesModal() {
    document.getElementById('roomTypeImagesModal').style.display = 'none';
}

document.getElementById('roomTypeImageUploadForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const roomType = document.getElementById('roomTypeInput').value;

    fetch(`http://localhost:5000/upload-room-image-type/${hotelId}`, {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            console.log('Image uploaded successfully for all rooms of the same type:', data);
            closeRoomTypeImagesModal();
        } else {
            console.error('Error in server response:', data);
        }
    })
    .catch(error => {
        console.error('Error uploading image for room type:', error);
    });
});
// Initialize step tracker and category image count
let currentStep = 1;

function openHotelImagesModal() {
    document.getElementById('hotelImagesModal').style.display = 'block';
    initializeStep(currentStep);
}

function closeHotelImagesModal() {
    document.getElementById('hotelImagesModal').style.display = 'none';
}

function goToNextStep(step) {
    // Hide the current step
    const currentStepElement = document.getElementById(`step${currentStep}`);
    if (currentStepElement) {
        currentStepElement.style.display = 'none';
    }

    // Update the current step
    currentStep = step;

    // Show the next step
    initializeStep(currentStep);
}

// Initialize the step
function initializeStep(step) {
    // Hide all steps first
    const allSteps = document.querySelectorAll('.upload-step');
    allSteps.forEach(step => step.style.display = 'none');
    
    // Ensure the step exists
    const stepElement = document.getElementById(`step${step}`);
    if (stepElement) {
        stepElement.style.display = 'block'; // Show the current step
    } else {
        console.error(`Step ${step} does not exist in the DOM.`);
    }

    // Set up the step images accordingly
    switch (step) {
        case 1:
            addImageInputs('banner', 21, 'bannerImagesContainer');
            break;
        case 2:
            addImageInputs('blog', 12, 'blogImagesContainer');
            break;
        case 3:
            addImageInputs('offers', 12, 'offersImagesContainer');
            break;
        case 4:
            addImageInputs('pricing', 3, 'pricingImagesContainer');
            break;
        case 5:
            addImageInputs('rooms', 12, 'roomsImagesContainer');
            break;
        case 6:
            addImageInputs('spa', 5, 'spaImagesContainer');
            break;
        case 7:
            addImageInputs('team', 5, 'teamImagesContainer');
            break;
        case 8:
            addImageInputs('clients', 6, 'clientsImagesContainer');
            break;
        case 9:
            addImageInputs('about', 2, 'aboutImagesContainer');
            break;
        case 10:
            addImageInputs('contact', 3, 'contactImagesContainer');
            break;
        case 11:
            addImageInputs('favicon', 1, 'faviconImagesContainer');
            break;
        case 12:
            addImageInputs('logo', 2, 'logoImagesContainer');
            break;
        case 13:
            addImageInputs('preloader', 1, 'preloaderImagesContainer');
            break;
        case 14:
            addImageInputs('restaurant', 6, 'restaurantImagesContainer');
            break;
            
        default:
            console.error("Invalid step number: ", step);
            break;
    }
}

// Function to add image inputs dynamically
function addImageInputs(category, numImages, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';  // Clear any existing inputs

    for (let i = 1; i <= numImages; i++) {
        const inputContainer = document.createElement('div');
        inputContainer.classList.add('image-input-container');
        
        const label = document.createElement('label');
        label.innerText = `Upload ${category} Image ${i}:`;
        inputContainer.appendChild(label);
        
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.name = `${category}-image-${i}`;
        fileInput.accept = 'image/*';

        // Pass category and image number to the uploadImage function
        fileInput.addEventListener('change', function() {
            uploadImage(fileInput, category, i, numImages);  // Pass numImages here
        });
        inputContainer.appendChild(fileInput);
        
        container.appendChild(inputContainer);
    }
}

// Function to handle image upload
function uploadImage(fileInput, category, imageIndex, numImages) {
    const formData = new FormData();
    formData.append('image', fileInput.files[0]);
    formData.append('category', category);
    formData.append('description', `${category} Image ${imageIndex}`);

    // Send the image data to the backend
    fetch(`http://localhost:5000/upload-hotel-image/${hotelId}`, {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            console.log('Image uploaded successfully:', data);
            alert(`${category} Image ${imageIndex} uploaded successfully!`);
            // Check if all images are uploaded, and show "Next Step" button if last image
            if (imageIndex === numImages) {
                document.getElementById(`nextStepBtn${currentStep}`).style.display = 'block';
            }
        } else {
            console.error('Error uploading image:', data);
            alert('Error uploading image.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error uploading image.');
    });
}


// Function to fetch and display images for a specific hotel
function fetchAndDisplayImages(hotelId) {
    // Fetch images from the backend API
    fetch(`http://localhost:5000/hotel/${hotelId}/images`)
        .then(response => response.json())
        .then(data => {
            console.log('Fetched data:', data);  // Log full response to inspect it
            if (data.success && Array.isArray(data.images)) {
                data.images.forEach(image => {
                    displayImage(image);
                });
            } else {
                console.error('Images data is not in the expected format', data);
            }
        })
        .catch(error => {
            console.error('Error fetching images:', error);
        });
}

// Function to dynamically display the images
function displayImage(image) {
    const category = image.category;
    const imageUrl = `http://localhost:5000/${image.url}`;  // Assuming the backend serves static files
    const imageNumber = image.imageNumber;

    // Create an image element and append it to the correct container based on the category
    const imageElement = document.createElement('img');
    imageElement.src = imageUrl;
    imageElement.alt = image.description;
    imageElement.title = image.description;

    // Add the image to the correct category container
    const container = document.getElementById(`${category}ImagesContainer`);
    if (container) {
        const imageWrapper = document.createElement('div');
        imageWrapper.classList.add('image-wrapper');
        imageWrapper.appendChild(imageElement);

        const caption = document.createElement('p');
        caption.textContent = `Image ${imageNumber}: ${image.description}`;
        imageWrapper.appendChild(caption);

        container.appendChild(imageWrapper);
    } else {
        console.error(`No container found for category ${category}`);
    }
}


fetchAndDisplayImages(hotelId);

    </script>
    <script>
        // Fetch restaurant data from the backend
// Fetch restaurant data from the backend
fetch(`http://localhost:5000/hotel/${hotelId}/restaurant`)
    .then(response => response.json())
    .then(data => {
        console.log("Restaurant Data: ", data)
        const restaurantTableBody = document.querySelector('#restaurant-table tbody');
        restaurantTableBody.innerHTML = ''; // Clear the table before adding new rows
        
        data.restaurants.forEach(restaurant => {
            const row = document.createElement('tr');
            row.setAttribute('data-id', restaurant._id);  // Set data-id for the row

            // Create a cell for the restaurant's details
            row.innerHTML = `
                <td class="restaurant-name">${restaurant.name}</td>
                <td class="restaurant-type">${restaurant.type}</td>
                <td class="restaurant-description">${restaurant.description}</td>
                <td class="restaurant-opening-hours">${restaurant.openingHours.start} - ${restaurant.openingHours.end}</td>
                <td>
                    <button class="edit-restaurant-btn" data-id="${restaurant._id}">Edit</button>
                    <button class="delete-restaurant-btn" data-id="${restaurant._id}">Delete</button>
                </td>
            `;
            
            // Add menu items to the table row
            const menuList = document.createElement('ul');  // Create a list to hold menu items
            restaurant.menu.forEach(menuItem => {
                const menuItemElement = document.createElement('li');
                menuItemElement.innerHTML = `${menuItem.dishName}: ${menuItem.description} - $${menuItem.price}`;
                menuList.appendChild(menuItemElement);  // Append each menu item to the list
            });

            // Append the menu list as a new cell in the table row
            const menuCell = document.createElement('td');
            menuCell.appendChild(menuList);  // Add the list to the menu cell
            row.appendChild(menuCell);  // Append the menu cell to the row

            restaurantTableBody.appendChild(row);  // Finally, append the row to the table body
        });
    })
    .catch(error => console.error('Error fetching restaurants:', error));


// Handle Add Restaurant Button
document.getElementById('add-restaurant-btn').addEventListener('click', () => {
    document.getElementById('restaurant-form').reset();
    document.getElementById('save-restaurant-btn').textContent = 'Save';
    document.getElementById('restaurant-modal').style.display = 'block';
});

document.getElementById('restaurant-form').addEventListener('submit', (event) => {
    event.preventDefault(); // Prevent default form submission

    const restaurantData = {
        name: document.getElementById('restaurant-name').value,
        type: document.getElementById('restaurant-type').value,
        description: document.getElementById('restaurant-description').value,
        chef: document.getElementById('restaurant-chef').value,  // Get chef value
        aboutRestaurant: document.getElementById('restaurant-about').value,  // Get about-restaurant value
        openingHours: {
            start: document.getElementById('restaurant-opening-hours-start').value,
            end: document.getElementById('restaurant-opening-hours-end').value,
        },
        menu: [] // Initialize an empty menu array
    };

    // Collect all menu items
    document.querySelectorAll('.menu-item').forEach(menuItem => {
        const dishName = menuItem.querySelector('.dish-name').value;
        const dishDescription = menuItem.querySelector('.dish-description').value;
        const dishPrice = menuItem.querySelector('.dish-price').value;

        if (dishName && dishDescription && dishPrice) {
            restaurantData.menu.push({
                dishName: dishName,
                description: dishDescription,
                price: parseFloat(dishPrice),
            });
        }
    });

    // Check if menu is empty
    if (restaurantData.menu.length === 0) {
        alert('Please add at least one menu item.');
        return;
    }

    const restaurantId = document.getElementById('restaurant-id').value;
    const method = restaurantId ? 'PUT' : 'POST';  // Use PUT if updating, POST if creating
    const url = restaurantId
        ? `http://localhost:5000/hotel/${hotelId}/restaurant/${restaurantId}`  // Update URL with restaurant ID
        : `http://localhost:5000/hotel/${hotelId}/restaurant`;  // Create URL without restaurant ID

    // Send the form data to the backend
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(restaurantData),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('Restaurant saved/updated successfully!');
        } else {
            alert('Error saving/updating restaurant: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving/updating restaurant.');
    });
});

// Handle Edit Restaurant
document.querySelector('#restaurant-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-restaurant-btn')) {
        const restaurantId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/restaurant/${restaurantId}`)
            .then(response => response.json())
            .then(data => {
                const restaurant = data.restaurant;
                
                console.log(restaurant);  // For debugging purposes
                
                // Check if openingHours exists before assigning values
                if (restaurant.openingHours) {
                    document.getElementById('restaurant-opening-hours-start').value = restaurant.openingHours.start || '';  
                    document.getElementById('restaurant-opening-hours-end').value = restaurant.openingHours.end || '';  
                } else {
                    document.getElementById('restaurant-opening-hours-start').value = '';
                    document.getElementById('restaurant-opening-hours-end').value = '';
                }

                document.getElementById('restaurant-name').value = restaurant.name;
                document.getElementById('restaurant-type').value = restaurant.type;
                document.getElementById('restaurant-description').value = restaurant.description;
                document.getElementById('restaurant-id').value = restaurant._id;
                document.getElementById('save-restaurant-btn').textContent = 'Update';  // Change button text to 'Update'
                document.getElementById('restaurant-modal').style.display = 'block';
            })
            .catch(err => {
                console.error('Error fetching restaurant data:', err);
                alert('Error fetching restaurant data.');
            });
    }
});
// Handle Delete Restaurant
document.querySelector('#restaurant-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('delete-restaurant-btn')) {
        const restaurantId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/restaurant/${restaurantId}`, { 
            method: 'DELETE' 
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Restaurant deleted!');
                const row = document.querySelector(`tr[data-id='${restaurantId}']`);
                if (row) {
                    row.remove();  // Remove the row from the table
                }
            } else {
                alert('Error deleting restaurant');
            }
        })
        .catch(err => console.error('Error in delete request:', err));
    }
});

// Handle the "Add Menu Item" Button Click

document.getElementById('add-menu-item-btn').addEventListener('click', () => {
    const menuItemsContainer = document.getElementById('menu-items');

    // Create a new div for the menu item fields
    const menuItemDiv = document.createElement('div');
    menuItemDiv.classList.add('menu-item');

    menuItemDiv.innerHTML = `
        <label for="dish-name">Dish Name</label>
        <input type="text" name="dishName" class="dish-name" required>

        <label for="dish-description">Dish Description</label>
        <input type="text" name="dishDescription" class="dish-description" required>

        <label for="dish-price">Dish Price</label>
        <input type="number" name="dishPrice" class="dish-price" required>

        <button type="button" class="remove-menu-item-btn">Remove</button>
    `;

    // Append the menu item to the container
    menuItemsContainer.appendChild(menuItemDiv);

    // Add functionality to remove the menu item
    menuItemDiv.querySelector('.remove-menu-item-btn').addEventListener('click', () => {
        menuItemsContainer.removeChild(menuItemDiv);
    });
});



    </script>
    

<script>
    // Fetch transportation services data from the backend
fetch(`http://localhost:5000/hotel/${hotelId}/transportation`)
    .then(response => response.json())
    .then(data => {
        const transportationTableBody = document.querySelector('#transportation-table tbody');
        transportationTableBody.innerHTML = ''; // Clear the table before adding new rows
        
        data.transportationServices.forEach(service => {
            const row = document.createElement('tr');
            row.setAttribute('data-id', service._id);  // Set data-id for the row

            // Create a cell for the transportation service's details
            row.innerHTML = `
                <td class="transportation-type">${service.type}</td>
                <td class="transportation-description">${service.description}</td>
                <td class="transportation-price">$${service.price}</td>
                <td class="transportation-availability">${service.availability ? 'Available' : 'Not Available'}</td>
                <td>
                    <button class="edit-transportation-btn" data-id="${service._id}">Edit</button>
                    <button class="delete-transportation-btn" data-id="${service._id}">Delete</button>
                </td>
            `;
            transportationTableBody.appendChild(row);  // Append the row to the table body
        });
    })
    .catch(error => console.error('Error fetching transportation services:', error));
    document.getElementById('add-transportation-btn').addEventListener('click', () => {
    document.getElementById('transportation-form').reset();
    document.getElementById('save-transportation-btn').textContent = 'Save';
    document.getElementById('transportation-modal').style.display = 'block';
});

document.getElementById('add-transportation-btn').addEventListener('click', () => {
    document.getElementById('transportation-form').reset();
    document.getElementById('save-transportation-btn').textContent = 'Save';
    document.getElementById('transportation-modal').style.display = 'block';
});

document.getElementById('transportation-form').addEventListener('submit', (event) => {
    event.preventDefault(); // Prevent default form submission

    const transportationData = {
        type: document.getElementById('transportation-type').value,
        description: document.getElementById('transportation-description').value,
        price: parseFloat(document.getElementById('transportation-price').value),
        availability: document.getElementById('transportation-availability').checked,
    };

    const transportationId = document.getElementById('transportation-id').value;
    const method = transportationId ? 'PUT' : 'POST';  // Use PUT if updating, POST if creating
    const url = transportationId
        ? `http://localhost:5000/hotel/${hotelId}/transportation/${transportationId}`  // Update URL with transportation ID
        : `http://localhost:5000/hotel/${hotelId}/transportation`;  // Create URL without transportation ID

    // Send the form data to the backend
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(transportationData),
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            if (method === 'POST') {
                alert('Transportation service created successfully!');
            } else {
                alert('Transportation service updated successfully!');
                // Update the service in the table without refreshing the page
                const row = document.querySelector(`tr[data-id='${transportationId}']`);
                if (row) {
                    row.querySelector('.transportation-type').textContent = result.transportation.type;
                    row.querySelector('.transportation-description').textContent = result.transportation.description;
                    row.querySelector('.transportation-price').textContent = `$${result.transportation.price}`;
                    row.querySelector('.transportation-availability').textContent = result.transportation.availability ? 'Available' : 'Not Available';
                }
            }
        } else {
            alert('Error saving/updating transportation service: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving/updating transportation service.');
    });
});

document.querySelector('#transportation-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-transportation-btn')) {
        const transportationId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/transportation/${transportationId}`)
            .then(response => response.json())
            .then(data => {
                const service = data.transportation;

                // Populate the form with the service data
                document.getElementById('transportation-type').value = service.type;
                document.getElementById('transportation-description').value = service.description;
                document.getElementById('transportation-price').value = service.price;
                document.getElementById('transportation-availability').checked = service.availability;
                document.getElementById('transportation-id').value = service._id;
                document.getElementById('save-transportation-btn').textContent = 'Update';
                document.getElementById('transportation-modal').style.display = 'block';
            })
            .catch(err => {
                console.error('Error fetching transportation service data:', err);
                alert('Error fetching transportation service data.');
            });
    }
});

document.querySelector('#transportation-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('delete-transportation-btn')) {
        const transportationId = event.target.getAttribute('data-id');
        fetch(`http://localhost:5000/hotel/${hotelId}/transportation/${transportationId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Transportation service deleted!');
                const row = document.querySelector(`tr[data-id='${transportationId}']`);
                if (row) {
                    row.remove();  // Remove the row from the table
                }
            } else {
                alert('Error deleting transportation service');
            }
        })
        .catch(err => console.error('Error in delete request:', err));
    }
});



</script>
<script>
    // Fetch accessibility features
fetch(`http://localhost:5000/hotel/${hotelId}/accessibility`)
    .then(response => response.json())
    .then(data => {
        const accessibilityTableBody = document.querySelector('#accessibility-table tbody');
        accessibilityTableBody.innerHTML = '';  // Clear the table before adding new rows

        data.accessibilityFeatures.forEach(feature => {
            const row = document.createElement('tr');
            row.setAttribute('data-id', feature._id);  // Store feature ID for later actions

            row.innerHTML = `
                <td class="accessibility-feature">${feature.feature}</td>
                <td class="accessibility-description">${feature.description}</td>
                <td>
                    <button class="edit-accessibility-btn" data-id="${feature._id}">Edit</button>
                    <button class="delete-accessibility-btn" data-id="${feature._id}">Delete</button>
                </td>
            `;
            accessibilityTableBody.appendChild(row);
        });
    })
    .catch(error => console.error('Error fetching accessibility features:', error));

    document.getElementById('add-accessibility-btn').addEventListener('click', () => {
    document.getElementById('accessibility-form').reset();
    document.getElementById('save-accessibility-btn').textContent = 'Save';
    document.getElementById('accessibility-modal').style.display = 'block';
});

document.getElementById('accessibility-form').addEventListener('submit', (event) => {
    event.preventDefault();

    const accessibilityData = {
        feature: document.getElementById('accessibility-feature').value,
        description: document.getElementById('accessibility-description').value
    };

    const accessibilityId = document.getElementById('accessibility-id').value;
    const method = accessibilityId ? 'PUT' : 'POST';  // Use PUT if updating, POST if creating
    const url = accessibilityId
        ? `http://localhost:5000/hotel/${hotelId}/accessibility/${accessibilityId}`  // Update URL with ID
        : `http://localhost:5000/hotel/${hotelId}/accessibility`;  // Create URL

    fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(accessibilityData)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert(method === 'POST' ? 'Accessibility feature created!' : 'Accessibility feature updated!');
            // Refresh the table after saving
            location.reload();  // Or use a function to reload the data
        } else {
            alert('Error saving/updating accessibility feature: ' + result.message);
        }
    })
    .catch(error => console.error('Error:', error));
});

document.querySelector('#accessibility-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('edit-accessibility-btn')) {
        const featureId = event.target.getAttribute('data-id');  // Get the feature ID from the button's data-id attribute

        fetch(`http://localhost:5000/hotel/${hotelId}/accessibility/${featureId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const feature = data.feature;

                    // Populate the form with the data of the accessibility feature
                    document.getElementById('accessibility-feature').value = feature.feature;
                    document.getElementById('accessibility-description').value = feature.description;
                    document.getElementById('accessibility-id').value = feature._id;  // Set the feature's ID for updating
                    document.getElementById('save-accessibility-btn').textContent = 'Update';
                    document.getElementById('accessibility-modal').style.display = 'block';  // Show the modal for editing
                } else {
                    alert('Error fetching accessibility feature data');
                }
            })
            .catch(err => {
                console.error('Error fetching accessibility feature data:', err);
                alert('Error fetching accessibility feature data.');
            });
    }
});

document.querySelector('#accessibility-table').addEventListener('click', (event) => {
    if (event.target.classList.contains('delete-accessibility-btn')) {
        const accessibilityId = event.target.getAttribute('data-id');
        if (confirm('Are you sure you want to delete this accessibility feature?')) {
            fetch(`http://localhost:5000/hotel/${hotelId}/accessibility/${accessibilityId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('Accessibility feature deleted!');
                    const row = document.querySelector(`tr[data-id='${accessibilityId}']`);
                    if (row) row.remove();  // Remove the row from the table
                } else {
                    alert('Error deleting accessibility feature');
                }
            })
            .catch(err => console.error('Error in delete request:', err));
        }
    }
});



</script>
<script>
      // Open the modal for adding a new spa service
      document.getElementById('add-spa-btn').addEventListener('click', () => {
            document.getElementById('spa-form').reset();
            document.getElementById('spa-id').value = '';
            document.getElementById('modal-title').textContent = 'Add Spa Service';
            document.getElementById('save-spa-btn').textContent = 'Save';
            document.getElementById('spa-modal').style.display = 'flex';
        });

        // Close the modal
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('spa-modal').style.display = 'none';
        });

        // Fetch and display spa services from the server
        function fetchSpaServices() {
            fetch(`http://localhost:5000/hotel/${hotelId}/spa`)
                .then(response => response.json())
                .then(data => {
                    const spaTableBody = document.querySelector('#spa-table tbody');
                    spaTableBody.innerHTML = ''; // Clear the table before adding new rows
                    console.log("data for spa: " , data)
                    data.spaServices.forEach(service => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', service._id);
                        
                        row.innerHTML = `
                            <td class="spa-name">${service.name}</td>
                            <td class="spa-description">${service.description}</td>
                            <td class="spa-price">$${service.price}</td>
                            <td class="spa-duration">${service.duration}</td>
                            <td>
                                <button class="edit-spa-btn" data-id="${service._id}">Edit</button>
                                <button class="delete-spa-btn" data-id="${service._id}">Delete</button>
                            </td>
                        `;
                        spaTableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching spa services:', error));
        }

        // Handle the form submit for creating or updating a spa service
        document.getElementById('spa-form').addEventListener('submit', (event) => {
            event.preventDefault();
            
            const spaData = {
                name: document.getElementById('spa-name').value,
                description: document.getElementById('spa-description').value,
                price: parseFloat(document.getElementById('spa-price').value),
                duration: document.getElementById('spa-duration').value,
            };

            const spaId = document.getElementById('spa-id').value;
            const method = spaId ? 'PUT' : 'POST';
            const url = spaId
                ? `http://localhost:5000/hotel/${hotelId}/spa/${spaId}`
                : `http://localhost:5000/hotel/${hotelId}/spa`;

            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(spaData),
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(spaId ? 'Spa Service updated!' : 'Spa Service created!');
                    fetchSpaServices(); // Refresh the list
                    document.getElementById('spa-modal').style.display = 'none';
                } else {
                    alert('Error saving spa service');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving spa service');
            });
        });

        // Handle Edit Spa
        document.querySelector('#spa-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('edit-spa-btn')) {
                const spaId = event.target.getAttribute('data-id');
                fetch(`http://localhost:5000/hotel/${hotelId}/spa/${spaId}`)
                    .then(response => response.json())
                    .then(data => {
                        const spaService = data.spaService;
                        
                        // Populate the form with existing data
                        document.getElementById('spa-id').value = spaService._id;
                        document.getElementById('spa-name').value = spaService.name;
                        document.getElementById('spa-description').value = spaService.description;
                        document.getElementById('spa-price').value = spaService.price;
                        document.getElementById('spa-duration').value = spaService.duration;
                        document.getElementById('modal-title').textContent = 'Edit Spa Service';
                        document.getElementById('save-spa-btn').textContent = 'Update';
                        
                        // Open the modal
                        document.getElementById('spa-modal').style.display = 'flex';
                    })
                    .catch(err => {
                        console.error('Error fetching spa service:', err);
                        alert('Error fetching spa service');
                    });
            }
        });

        // Handle Delete Spa
        document.querySelector('#spa-table').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-spa-btn')) {
                const spaId = event.target.getAttribute('data-id');
                fetch(`http://localhost:5000/hotel/${hotelId}/spa/${spaId}`, { 
                    method: 'DELETE' 
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        alert('Spa Service deleted!');
                        fetchSpaServices(); // Refresh the list
                    } else {
                        alert('Error deleting spa service');
                    }
                })
                .catch(err => console.error('Error in delete request:', err));
            }
        });

        // Initial call to display spa services
        fetchSpaServices();
</script>
<script>
   let currentStepVideo = 1;

function openHotelVideosModal() {
    document.getElementById('hotelVideosModal').style.display = 'block';
    initializeVideoStep(currentStepVideo);
}

function closeHotelVideosModal() {
    document.getElementById('hotelVideosModal').style.display = 'none';
}

function goToNextStepVideo(stepvideo) {
    // Hide the current step
    const currentStepElement = document.getElementById(`stepvideo${currentStepVideo}`);
    if (currentStepElement) {
        currentStepElement.style.display = 'none';
    }

    // Update the current step
    currentStepVideo = stepvideo;

    // Show the next step
    initializeVideoStep(currentStepVideo);
}

// Initialize the video upload step
function initializeVideoStep(stepvideo) {
    // Hide all steps first
    const allSteps = document.querySelectorAll('.upload-stepvideo');
    allSteps.forEach(step => step.style.display = 'none');
    
    // Ensure the step exists
    const stepElement = document.getElementById(`stepvideo${stepvideo}`);
    if (stepElement) {
        stepElement.style.display = 'block'; // Show the current step
    } else {
        console.error(`Step ${stepvideo} does not exist in the DOM.`);
    }

    // Set up the video inputs accordingly
    switch (stepvideo) {
        case 1:
            addVideoInputs('rooms', 2, 'roomsVideosContainer');
            break;
        case 2:
            addVideoInputs('pool', 2, 'poolVideosContainer');
            break;
        case 3:
            addVideoInputs('reception', 3, 'receptionVideosContainer');
            break;
        case 4:
            addVideoInputs('general', 5, 'generalVideosContainer');
            break;
        default:
            console.error("Invalid step number: ", stepvideo);
            break;
    }
}

// Function to add video inputs dynamically
function addVideoInputs(category, numVideos, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';  // Clear any existing inputs

    for (let i = 1; i <= numVideos; i++) {
        const inputContainer = document.createElement('div');
        inputContainer.classList.add('video-input-container');
        
        const label = document.createElement('label');
        label.innerText = `Upload ${category} Video ${i}:`;
        inputContainer.appendChild(label);
        
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.name = `${category}-video-${i}`;
        fileInput.accept = 'video/mp4, video/webm, video/ogg';

        // Description input field for each video
        const descriptionLabel = document.createElement('label');
        descriptionLabel.innerText = `Description for ${category} Video ${i}:`;
        const descriptionInput = document.createElement('input');
        descriptionInput.type = 'text';
        descriptionInput.name = `${category}-video-${i}-description`;

        inputContainer.appendChild(descriptionLabel);
        inputContainer.appendChild(descriptionInput);
        
        // Pass category, video number, and description input to the upload function
        fileInput.addEventListener('change', function() {
            uploadVideo(fileInput, descriptionInput, category, i, numVideos);
        });

        inputContainer.appendChild(fileInput);
        container.appendChild(inputContainer);
    }
}

// Function to handle video upload
function uploadVideo(fileInput, descriptionInput, category, videoIndex, numVideos) {
    const formData = new FormData();
    formData.append('video', fileInput.files[0]);
    formData.append('category', category);
    formData.append('description', descriptionInput.value);  // Get custom description from input field

    // Send the video data to the backend
    fetch(`http://localhost:5000/upload-hotel-video/${hotelId}`, {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            console.log('Video uploaded successfully:', data);
            alert(`${category} Video ${videoIndex} uploaded successfully!`);
            // Check if all videos are uploaded, and show "Next Step" button if last video
            if (videoIndex === numVideos) {
                document.getElementById(`nextStepBtnVideo${currentStepVideo}`).style.display = 'block';
            }
        } else {
            console.error('Error uploading video:', data);
            alert('Error uploading video.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error uploading video.');
    });
}
// Function to fetch and display videos for a specific hotel
function fetchAndDisplayVideos(hotelId) {
    // Fetch videos from the backend API
    fetch(`http://localhost:5000/hotel/${hotelId}/videos`)
        .then(response => response.json())
        .then(data => {
            console.log('Fetched data videos:', data);  // Log full response to inspect it
            if (data.success && Array.isArray(data.videos)) {
                data.videos.forEach(video => {
                    displayVideo(video);
                });
            } else {
                console.error('Videos data is not in the expected format', data);
            }
        })
        .catch(error => {
            console.error('Error fetching videos:', error);
        });
}

// Function to dynamically display the videos
function displayVideo(video) {
    const category = video.category;  // Category like 'rooms' or 'pool'
    const videoUrl = `http://localhost:5000/${video.url}`;  // Assuming the backend serves static files
    const videoNumber = video.videoNumber;  // Video number
    const description = video.description || `Video ${videoNumber}`; // If there's a description, use it, otherwise default to "Video X"

    // Create a video element
    const videoElement = document.createElement('video');
    videoElement.style ="width: 600px; border-radius: 10px;"
    videoElement.src = videoUrl;
    videoElement.controls = true;  // Add video controls (play, pause, volume, etc.)
    videoElement.title = description;

    // Add the video to the correct category container
    const container = document.getElementById(`${category}VideosContainer`);
    if (container) {
        // Create a wrapper for the video
        const videoWrapper = document.createElement('div');
        videoWrapper.classList.add('video-wrapper');
        videoWrapper.appendChild(videoElement);

        // Create a caption (optional)
        const caption = document.createElement('p');
        caption.textContent = `Video ${videoNumber}: ${description}`;
        videoWrapper.appendChild(caption);

        // Append the wrapper with the video and caption to the container
        container.appendChild(videoWrapper);
    } else {
        console.error(`No container found for category ${category}`);
    }
}

fetchAndDisplayVideos(hotelId);

  // Toggle the visibility of the video display container
  document.getElementById('toggleVideosBtn').addEventListener('click', toggleVideos);

  function toggleVideos() {
    const container = document.getElementById('roomsVideosContainer');
    const container2 = document.getElementById("hotelVideosModal")
    const currentDisplay = container.style.display;
    const currentDisplay2 = container.style.display;

    // If the container is hidden, show it; if it is shown, hide it
    if ((currentDisplay === 'none' || currentDisplay === '') && (currentDisplay2 === 'none' || currentDisplay2 === '') ) {
      container.style.display = 'block';
      container2.style.display = 'block';

    } else {
      container.style.display = 'none';
      container2.style.display = 'none';
    }
  }

</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const hotelId = window.env.HOTELID2;  // Example hotelId

        // Fetch the bookings and booking emails from the backend
        fetch(`http://localhost:5000/get-hotel-details/${hotelId}`)
            .then(response => response.json())
            .then(data => {
                console.log("Booking data: ", data);
                if (data.bookings && data.bookingEmail) {  // Check if bookings and bookingEmail are present
                    const bookings = data.bookings;
                    const bookingEmails = data.bookingEmail;  // Booking emails from response

                    displayBookings(bookings, bookingEmails);

                    // Add event listeners for filters
                    document.getElementById('refunded-filter').addEventListener('change', updateTable);
                    document.getElementById('checkin-today-filter').addEventListener('change', updateTable);
                    document.getElementById('checkout-today-filter').addEventListener('change', updateTable);
                    document.getElementById('current-week-filter').addEventListener('change', updateTable);

                    // Add event listener for search bar
                    document.getElementById('search-bar').addEventListener('input', updateTable);
                } else {
                    alert('No bookings found or error fetching data');
                }
            })
            .catch(error => {
                console.error('Error fetching bookings:', error);
                alert('There was an error fetching bookings.');
            });

        // Function to display the bookings in a table
        function displayBookings(bookings, bookingEmails) {
            window.bookingsData = bookings; // Save bookingsData globally for future reference
            window.bookingEmailsData = bookingEmails; // Save bookingEmailsData globally

            renderTable(bookings);
        }

        // Function to render the table with filtered bookings
        function renderTable(bookings) {
            const tableBody = document.getElementById('bookings-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';  // Clear the table before re-rendering

            bookings.forEach(booking => {
                const row = document.createElement('tr');

                // Display confirmation number instead of booking ID
                const confirmationNumberCell = document.createElement('td');
                confirmationNumberCell.textContent = booking.confirmationNumber || 'Unknown';  // Use confirmationNumber here
                row.appendChild(confirmationNumberCell);

                // Get customer details from bookingEmail by matching confirmationNumber
                const customerNameCell = document.createElement('td');
                const customer = getCustomerFromBookingEmail(booking, window.bookingEmailsData);  // Find customer data by matching confirmationNumber
                if (customer) {
                    customerNameCell.textContent = customer.firstName + ' ' + customer.lastName || 'Unknown';  // Display full name
                } else {
                    customerNameCell.textContent = 'Unknown';  // Fallback if no customer data found
                }
                row.appendChild(customerNameCell);

                const roomTypeCell = document.createElement('td');
                roomTypeCell.textContent = booking.roomType || 'Unknown';  // Display roomType or fallback if undefined
                row.appendChild(roomTypeCell);

                const checkinDateCell = document.createElement('td');
                checkinDateCell.textContent = new Date(booking.checkInDate).toLocaleDateString();
                row.appendChild(checkinDateCell);

                const checkoutDateCell = document.createElement('td');
                checkoutDateCell.textContent = new Date(booking.checkOutDate).toLocaleDateString();
                row.appendChild(checkoutDateCell);

                const bookingDateCell = document.createElement('td');
                bookingDateCell.textContent = new Date(booking.bookingDate).toLocaleDateString();
                row.appendChild(bookingDateCell);

                const amountCell = document.createElement('td');
                amountCell.textContent = `$${booking.amount}`;
                row.appendChild(amountCell);

                const paymentStatusCell = document.createElement('td');
                paymentStatusCell.textContent = booking.paymentStatus || 'Unknown';  // Ensure this value is valid
                row.appendChild(paymentStatusCell);

                // Add action buttons (e.g., to cancel booking)
                const actionCell = document.createElement('td');
                const cancelBtn = document.createElement('button');

                // If the booking is refunded, disable the button and change its style
                if (booking.paymentStatus === 'refunded') {
                    cancelBtn.textContent = 'Booking refunded';  // Change button text to indicate it's cancelled
                    cancelBtn.disabled = true;  // Disable the button
                    cancelBtn.style.backgroundColor = '#ccc';  // Set a gray color for the button
                    cancelBtn.style.cursor = 'not-allowed';  // Change the cursor to indicate the button is not clickable
                } else if (booking.paymentStatus === 'cancelled') {
                    cancelBtn.textContent = 'Booking Cancelled';  // Change button text to indicate it's cancelled
                    cancelBtn.disabled = true;  // Disable the button
                    cancelBtn.style.backgroundColor = '#ccc';  // Set a gray color for the button
                    cancelBtn.style.cursor = 'not-allowed';  // Change the cursor to indicate the button is not clickable
                } else {
                    cancelBtn.textContent = 'Cancel Booking';
                    cancelBtn.addEventListener('click', () => cancelBooking(booking.confirmationNumber, booking.paymentStatus));  // Use confirmationNumber and paymentStatus for cancellation
                }

                actionCell.appendChild(cancelBtn);
                row.appendChild(actionCell);

                tableBody.appendChild(row);
            });
        }

        // Function to handle cancel booking action
        function cancelBooking(confirmationNumber, paymentStatus) {
            const hotelID = "76575619-383e-44b3-9d9c-fd913afef0a1"; // Make sure this hotelID is correct in the cancel request
            const url = paymentStatus === 'paid' 
                ? `http://localhost:5000/hotel/${hotelID}/booking/cancel/${confirmationNumber}` 
                : `http://localhost:5000/hotel/${hotelID}/booking/cancel/cash/${confirmationNumber}`;

            if (confirm('Are you sure you want to cancel this booking?')) {
                fetch(url, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Booking cancelled successfully!');
                        location.reload();  // Reload to reflect the changes
                    } else {
                        alert('Error canceling booking: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error canceling booking:', error);
                    alert('There was an error canceling the booking.');
                });
            }
        }

        // Function to get customer details from bookingEmail data by matching confirmationNumber
        function getCustomerFromBookingEmail(booking, bookingEmails) {
            // Match the booking's confirmationNumber with the bookingEmails list
            return bookingEmails.find(emailData => emailData.confirmationNumber === booking.confirmationNumber);
        }

        // Filter bookings based on selected checkboxes and search input
        function updateTable() {
            let filteredBookings = window.bookingsData;

            // Refunded filter
            if (document.getElementById('refunded-filter').checked) {
                filteredBookings = filteredBookings.filter(booking => booking.paymentStatus === 'refunded');
            }

            // Check-in today filter
            if (document.getElementById('checkin-today-filter').checked) {
                const today = new Date().toLocaleDateString();
                filteredBookings = filteredBookings.filter(booking => new Date(booking.checkInDate).toLocaleDateString() === today);
            }

            // Check-out today filter
            if (document.getElementById('checkout-today-filter').checked) {
                const today = new Date().toLocaleDateString();
                filteredBookings = filteredBookings.filter(booking => new Date(booking.checkOutDate).toLocaleDateString() === today);
            }

            // Current week filter (Mon-Sun)
            if (document.getElementById('current-week-filter').checked) {
                const startOfWeek = getStartOfWeek();
                const endOfWeek = getEndOfWeek();
                filteredBookings = filteredBookings.filter(booking => {
                    const checkinDate = new Date(booking.checkInDate);
                    return checkinDate >= startOfWeek && checkinDate <= endOfWeek;
                });
            }

            // Search filter (search by customer name or confirmation number)
            const searchTerm = document.getElementById('search-bar').value.toLowerCase();
            if (searchTerm) {
                filteredBookings = filteredBookings.filter(booking => {
                    const customerName = getCustomerFromBookingEmail(booking, window.bookingEmailsData);
                    const fullName = customerName ? (customerName.firstName + ' ' + customerName.lastName).toLowerCase() : '';
                    return fullName.includes(searchTerm) || booking.confirmationNumber.toLowerCase().includes(searchTerm);
                });
            }

            // Re-render the table with filtered bookings
            renderTable(filteredBookings);
        }

        // Get the start of the current week (Monday)
        function getStartOfWeek() {
            const today = new Date();
            const day = today.getDay() || 7; // Get the current day (Sun-Sat)
            today.setHours(0, 0, 0, 0); // Set time to midnight
            today.setDate(today.getDate() - day + 1); // Set to Monday
            return today;
        }

        // Get the end of the current week (Sunday)
        function getEndOfWeek() {
            const startOfWeek = getStartOfWeek();
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6); // Sunday is 6 days after Monday
            return endOfWeek;
        }
    });
</script>


<script>
  
  const hotelIdR = "6844e2596e4bf672d629e738";  // Example hotelId
    
        document.getElementById('fetch-room-data-btn').addEventListener('click', () => {
            
            const roomType = document.getElementById('room-type-select').value;
            fetchRoomData(hotelIdR, roomType);
        });

        // Fetch room data from the backend
        function fetchRoomData(hotelIdR, roomType) {
            fetch(`http://localhost:5000/hotel/${hotelIdR}/room-type/${roomType}`)
                .then(response => response.json())
                .then(roomData => {
                    console.log("Room Type Data: ", roomData); // Debugging log
                    
                    // Display room description and equipment
                    document.getElementById('room-description-text').innerText = roomData.roomDescription;

                    // Handle room equipment (if it exists)
                    if (roomData.roomEquipment && Array.isArray(roomData.roomEquipment)) {
                        displayRoomEquipment(roomData.roomEquipment);
                    } else {
                        document.getElementById('equipment-list').innerText = 'No equipment available';
                    }

                    // Show the details section
                    document.getElementById('room-details-section').style.display = 'block';

                    // Enable the edit description button
                    document.getElementById('edit-description-btn').setAttribute('data-room-type', roomType);
                    document.getElementById('edit-description-btn').style.display = 'inline-block';
                })
                .catch(error => {
                    console.error('Error fetching room data:', error);
                    alert('Failed to fetch room data');
                });
        }

        // Display room equipment
        function displayRoomEquipment(equipmentArray) {
            const equipmentList = document.getElementById('equipment-list');
            equipmentList.innerHTML = ''; // Clear any previous data

            equipmentArray.forEach(item => {
                const listItem = document.createElement('li');
                listItem.textContent = `${item.equipment}: ${item.description}`;
                equipmentList.appendChild(listItem);
            });
        }

        // Edit room description and equipment
        document.getElementById('edit-description-btn').addEventListener('click', () => {
            const roomType = document.getElementById('edit-description-btn').getAttribute('data-room-type');
            openEditModal(roomType);
        });

        // Open the Edit Modal
        function openEditModal(roomType) {
            fetch(`http://localhost:5000/hotel/${hotelIdR}/room-type/${roomType}`)
                .then(response => response.json())
                .then(roomData => {
                    // Populate the modal with current room data
                    document.getElementById('room-description-edit').value = roomData.roomDescription;

                    // Populate equipment fields dynamically
                    const equipmentEditSection = document.getElementById('equipment-edit-section');
                    equipmentEditSection.innerHTML = ''; // Clear existing fields

                    roomData.roomEquipment.forEach((equipment, index) => {
                        const div = document.createElement('div');
                        div.innerHTML = `
                            <label for="equipment-${index}">${equipment.equipment}:</label>
                            <input type="text" id="equipment-${index}" value="${equipment.description}" />
                        `;
                        equipmentEditSection.appendChild(div);
                    });

                    // Show the modal
                    document.getElementById('roomDescriptionEditModal').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching room data for edit:', error);
                    alert('Failed to fetch room data for edit');
                });
        }

        // Save the changes made in the edit modal
        document.getElementById('save-room-description-btnR').addEventListener('click', () => {
            const roomType = document.getElementById('edit-description-btn').getAttribute('data-room-type');
            const updatedDescription = document.getElementById('room-description-edit').value;

            // Gather updated equipment data
            const updatedEquipment = gatherUpdatedEquipment();

            // Send updated data to server
            fetch(`http://localhost:5000/hotel/${hotelIdR}/room-type/${roomType}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    roomDescription: updatedDescription,
                    roomEquipment: updatedEquipment
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Room updated:', data);
                location.reload(); // Refresh the page to see the updates
            })
            .catch(error => {
                console.error('Error updating room:', error);
            });
        });

      // Gather the updated equipment from modal fields
function gatherUpdatedEquipment() {
    const equipmentFields = document.querySelectorAll('#equipment-edit-section input');
    const updatedEquipment = [];

    equipmentFields.forEach((input, index) => {
        const equipmentName = document.querySelector(`#equipment-${index}`).previousElementSibling.innerText; // Get the equipment name from the label
        updatedEquipment.push({
            equipment: equipmentName,
            description: input.value
        });
    });

    return updatedEquipment;
}


        // Cancel the editing process
        document.getElementById('cancel-edit-btnR').addEventListener('click', () => {
            document.getElementById('roomDescriptionEditModal').style.display = 'none';
        });



 

    </script>
    
    <script>
           // Function to calculate distance between two points
    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // Radius of the earth in km
        const dLat = deg2rad(lat2 - lat1);
        const dLon = deg2rad(lon2 - lon1);
        const a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const d = R * c; // Distance in km
        return d;
    }
        // Function to add or update hotel URL
        document.getElementById('url-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const hotelID = window.env.HOTELID1; // Example hotelId, you can dynamically assign this
  const hotelId = window.env.HOTELID2; // Replace with the actual hotel ID
            
            const hotelUrl = document.getElementById('hotelUrl').value;

            try {
                const response = await fetch('http://localhost:5000/add-hotel-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ hotelId, url: hotelUrl })
                });

                if (response.ok) {
                    alert('Hotel URL added/updated successfully!');
                } else {
                    alert('Error adding/updating hotel URL');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

        // Function to delete hotel URL
        async function deleteHotelUrl() {
            
            const hotelID = window.env.HOTELID1; // Example hotelId, you can dynamically assign this
  const hotelId = window.env.HOTELID2; // Replace with the actual hotel ID
            
            if (!hotelId) {
                alert('Please enter Hotel ID');
                return;
            }

            try {
                const response = await fetch('http://localhost:5000/delete-hotel-url', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ hotelId })
                });

                if (response.ok) {
                    alert('Hotel URL deleted successfully!');
                } else {
                    alert('Error deleting hotel URL');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    </script>

<script>
    // Replace this with the actual hotel ID dynamically
    const hotelId3 = "6844e2596e4bf672d629e738";  // Example hotel ID, replace with actual ID

    // Function to fetch and display current distances
    async function fetchCurrentDistances() {
        const response = await fetch(`http://localhost:5000/get-hotel-distances/${hotelId3}`);
        const hotel = await response.json();

        // Set the form and display the available haram options based on the hotel's location
        const haramSelect = document.getElementById('haram');
        const meccaDistance = hotel.awayFromHaram.find(entry => entry.haram === 'mecca');
        const medinaDistance = hotel.awayFromHaram.find(entry => entry.haram === 'medinah');

        // Restrict form based on hotel location
        if (hotel.location.toLowerCase() === 'meccah') {
            haramSelect.innerHTML = '<option value="mecca">Mecca</option>'; // Only Mecca available
            document.getElementById('currentMeccaDistance').textContent = `Mecca: ${meccaDistance ? meccaDistance.distance : 'No distance for Mecca'}`;
            document.getElementById('currentMedinaDistance').textContent = ''; // Hide Medina distance
        } else if (hotel.location.toLowerCase() === 'medinah') {
            haramSelect.innerHTML = '<option value="medinah">Medina</option>'; // Only Medina available
            document.getElementById('currentMedinaDistance').textContent = `Medina: ${medinaDistance ? medinaDistance.distance : 'No distance for Medina'}`;
            document.getElementById('currentMeccaDistance').textContent = ''; // Hide Mecca distance
        } else {
            // If location is not Mecca or Medina, hide both distances and allow user to choose
            document.getElementById('currentMeccaDistance').textContent = '';
            document.getElementById('currentMedinaDistance').textContent = '';
            haramSelect.innerHTML = '<option value="mecca">Mecca</option><option value="medinah">Medina</option>';
        }
    }

    // Call fetchCurrentDistances to display current values and set the form options based on location
    fetchCurrentDistances();

    // Function to handle form submission (Add/Update)
    document.getElementById('distanceForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const distance = document.getElementById('distance').value;
        const haram = document.getElementById('haram').value;

        const response = await fetch('http://localhost:5000/update-distance-to-haram', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ hotelId3: hotelId3, distance, haram }), // Ensure hotelId3 is the correct hotel ID
        });

        const result = await response.text();
        alert(result);

        // Refresh the displayed distances after adding/updating
        fetchCurrentDistances();
    });

    // Function to handle deleting the distance
    document.getElementById('deleteButton').addEventListener('click', async () => {
        const haram = document.getElementById('haram').value;

        const response = await fetch('http://localhost:5000/delete-distance-to-haram', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ hotelId3, haram }),
        });

        const result = await response.text();
        alert(result);

        // Refresh the displayed distances after deleting
        fetchCurrentDistances();
    });
</script>
<script>
          

            // Initialize the path map
            function initPathMap() {
                pathMap = L.map('pathMap').setView([21.4225, 39.8262], 16);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(pathMap);

                // Add hotel marker
                const hotelLat = localStorage.getItem('hotelLat');
                const hotelLng = localStorage.getItem('hotelLng');
                if (hotelLat && hotelLng) {
                    hotelMarker = L.marker([hotelLat, hotelLng], {
                        icon: L.divIcon({
                            className: 'hotel-marker',
                            html: '<div style="background-color: #4CAF50; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.3);"></div>',
                            iconSize: [24, 24]
                        })
                    }).addTo(pathMap);
                }

                // Load doors and add markers
                loadDoors();

                // Initialize path drawing
                pathMap.on('click', function(e) {
                    if (!pathLayer) {
                        pathPoints = [];
                        pathLayer = L.polyline([], {
                            color: '#4CAF50',
                            weight: 6,
                            opacity: 0.9
                        }).addTo(pathMap);
                    }
                    pathPoints.push([e.latlng.lat, e.latlng.lng]);
                    pathLayer.setLatLngs(pathPoints);
                    updatePathDetails();
                });

                // Double click to finish path
                pathMap.on('dblclick', function(e) {
                    e.originalEvent.preventDefault();
                    if (pathPoints.length > 1) {
                        document.getElementById('savePath').disabled = false;
                    }
                });
            }

            // Load doors from the server
            async function loadDoors() {
                try {
                    const response = await fetch('http://localhost:5000/api/doors');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const doors = await response.json();
                    console.log('Fetched doors:', doors); // Debug log
                    
                    const doorSelect = document.getElementById('startDoor');
                    if (!doorSelect) {
                        console.error('Door select element not found');
                        return;
                    }
                    
                    // Clear existing options except the first one
                    while (doorSelect.options.length > 1) {
                        doorSelect.remove(1);
                    }
                    
                    doors.forEach(door => {
                        // Add to select
                        const option = document.createElement('option');
                        option.value = door._id;
                        option.textContent = door.name;
                        doorSelect.appendChild(option);

                        // Add marker to map and store with door data
                        const marker = L.marker([door.coordinates.lat, door.coordinates.lon], {
                            title: door.name
                        }).addTo(pathMap);
                        
                        // Store door data with the marker
                        marker.doorData = {
                            id: door._id,
                            name: door.name,
                            coordinates: door.coordinates
                        };
                        
                        doorMarkers.push(marker);
                    });
                } catch (error) {
                    console.error('Error loading doors:', error);
                    alert('Error loading doors. Please check the console for details.');
                }
            }

            // Initialize the map and path drawing functionality
            async function initMapAndPathDrawing() {
                // Get hotel coordinates from the form
                const hotelLat = localStorage.getItem('hotelLat');
                const hotelLng = localStorage.getItem('hotelLng');
                if (!hotelLat || !hotelLng) {
                    console.error('Hotel coordinates not found');
                    return;
                }

                // Initialize map if not already initialized
                if (!pathMap) {
                    map = L.map('pathMap').setView([hotelLat, hotelLng], 16);
                    
                    // Add OpenStreetMap tile layer
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 19,
                        tileSize: 256,
                        noWrap: true
                    }).addTo(map);

                    // Add hotel marker
                    const hotelIcon = L.icon({
                        iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
                        shadowSize: [41, 41],
                        shadowAnchor: [12, 41]
                    });

                    L.marker([hotelLat, hotelLng], { icon: hotelIcon })
                        .addTo(map)
                        .bindPopup('Hotel Location')
                        .openPopup();
                }

                // Initialize path drawing
                map.on('click', function(e) {
                    if (!pathLayer) {
                        pathPoints = [];
                        pathLayer = L.polyline([], {
                            color: '#4CAF50',
                            weight: 6,
                            opacity: 0.9
                        }).addTo(map);
                    }
                    pathPoints.push([e.latlng.lat, e.latlng.lng]);
                    pathLayer.setLatLngs(pathPoints);
                    updatePathDetails();
                    // Enable save button when we have at least 2 points
                    if (pathPoints.length >= 2) {
                        document.getElementById('savePath').disabled = false;
                    }
                });

                // Double click to finish path
                map.on('dblclick', function(e) {
                    e.originalEvent.preventDefault();
                    if (pathPoints.length > 1) {
                        document.getElementById('savePath').disabled = false;
                    }
                });

                // Load doors and add markers
                await loadDoors();
            }

            // Initialize the map and path drawing when the page loads
            document.addEventListener('DOMContentLoaded', initMapAndPathDrawing);

            // Update path details display
            function updatePathDetails() {
                if (pathPoints.length > 0) {
                    const totalDistance = calculatePathDistance(pathPoints);
                    const estimatedTime = Math.ceil(totalDistance * 12); // Assuming 5 km/h walking speed
                    document.getElementById('pathDetails').innerHTML = `
                        <p><strong>Points:</strong> ${pathPoints.length}</p>
                        <p><strong>Distance:</strong> ${totalDistance.toFixed(2)} km</p>
                        <p><strong>Estimated Time:</strong> ${estimatedTime} minutes</p>
                    `;
                }
            }

            // Calculate total path distance
            function calculatePathDistance(points) {
                let totalDistance = 0;
                for (let i = 1; i < points.length; i++) {
                    totalDistance += calculateDistance(
                        points[i-1][0], points[i-1][1],
                        points[i][0], points[i][1]
                    );
                }
                return totalDistance;
            }

            // Calculate distance between two points
            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371; // Radius of the earth in km
                const dLat = deg2rad(lat2 - lat1);
                const dLon = deg2rad(lon2 - lon1);
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                const d = R * c; // Distance in km
                return d;
            }

            // Convert degrees to radians
            function deg2rad(deg) {
                return deg * (Math.PI / 180);
            }

            // Save the path
            document.getElementById('savePath').addEventListener('click', async function() {
                const pathName = document.getElementById('pathName').value;
                const pathDescription = document.getElementById('pathDescription').value;
                const startDoor = document.getElementById('startDoor').value;
                const hotelId = '6844e2596e4bf672d629e738'; // Use the MongoDB _id directly

                if (!pathName || !startDoor || pathPoints.length < 2 || !hotelId) {
                    alert('Please fill in all fields and draw a valid path');
                    return;
                }

                try {
                    // Get the selected door's details
                    const doorSelect = document.getElementById('startDoor');
                    const selectedDoor = doorSelect.options[doorSelect.selectedIndex];
                    const doorName = selectedDoor.text.split(' (')[0]; // Get door name without location

                    // Format coordinates properly
                    const formattedCoordinates = pathPoints.map(point => ({
                        lat: point[0],
                        lon: point[1]
                    }));

                    const response = await fetch('http://localhost:5000/api/walking-paths', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: pathName,
                            description: pathDescription,
                            coordinates: formattedCoordinates,
                            distance: calculatePathDistance(pathPoints),
                            estimatedTime: Math.ceil(calculatePathDistance(pathPoints) * 12),
                            startDoor: startDoor,
                            hotelId: hotelId, // Use the MongoDB _id
                            startPoint: {
                                name: "Hotel Entrance",
                                coordinates: {
                                    lat: pathPoints[0][0],
                                    lon: pathPoints[0][1]
                                }
                            },
                            destination: {
                                name: doorName,
                                coordinates: {
                                    lat: pathPoints[pathPoints.length - 1][0],
                                    lon: pathPoints[pathPoints.length - 1][1]
                                }
                            }
                        })
                    });

                    if (response.ok) {
                        alert('Path saved successfully!');
                        // Clear the path after successful save
                        if (pathLayer) {
                            map.removeLayer(pathLayer);
                            pathLayer = null;
                        }
                        pathPoints = [];
                        isDrawing = false;
                        document.getElementById('savePath').disabled = true;
                        document.getElementById('pathDetails').innerHTML = 'Click "Start Drawing" to begin drawing the path.';
                        // Clear the form
                        document.getElementById('pathName').value = '';
                        document.getElementById('pathDescription').value = '';
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to save path');
                    }
                } catch (error) {
                    console.error('Error saving path:', error);
                    alert('Error saving path: ' + error.message);
                }
            });

            // Clear the path
            document.getElementById('clearPath').addEventListener('click', clearPath);

            function clearPath() {
                if (pathLayer) {
                    map.removeLayer(pathLayer);
                    pathLayer = null;
                }
                pathPoints = [];
                document.getElementById('savePath').disabled = true;
                document.getElementById('pathDetails').innerHTML = 'Click on the map to start drawing the path. Click again to add points. Double click to finish the path.';
            }

            // Initialize the map when the page loads
            window.addEventListener('load', initPathMap);
        </script> 

<div id="imageUploadModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-btn" onclick="closeImageModal()">&times;</span>
        <h4>Add Image for Path Point</h4>
        <form id="imageUploadForm">
            <div class="form-group">
                <label for="segmentImage">Select Image:</label>
                <input type="file" id="segmentImage" accept="image/*" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="imageDescription">Description:</label>
                <textarea id="imageDescription" class="form-control" rows="3" placeholder="Describe this point..."></textarea>
            </div>
            <div id="imagePreview" style="margin: 10px 0; display: none;">
                <img id="previewImg" src="" style="max-width: 100%; max-height: 200px;">
            </div>
            <button type="button" class="btn btn-primary" onclick="saveSegmentImage()">Save</button>
            <button type="button" class="btn btn-secondary" onclick="closeImageModal()">Cancel</button>
        </form>
    </div>
</div>

<style>
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 500px;
    border-radius: 5px;
}

.close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close-btn:hover {
    color: black;
}

.path-point {
    background-color: #4CAF50;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.path-point.has-image {
    background-color: #2196F3;
}

.path-point:hover::after {
    content: attr(data-description);
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 5px;
    border-radius: 3px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
}
</style>

<script>
// ... existing code ...

// Show image upload modal
function showImageModal(pointIndex) {
    const modal = document.getElementById('imageUploadModal');
    const imageInput = document.getElementById('segmentImage');
    const descriptionInput = document.getElementById('imageDescription');
    const previewDiv = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    
    // Reset form
    imageInput.value = '';
    descriptionInput.value = '';
    previewDiv.style.display = 'none';
    previewImg.src = '';
    
    // Show modal
    modal.style.display = 'block';
    
    // Preview image when selected
    imageInput.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewDiv.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    };
}

// Close image modal
function closeImageModal() {
    document.getElementById('imageUploadModal').style.display = 'none';
}

// Save segment image
function saveSegmentImage() {
    const imageInput = document.getElementById('segmentImage');
    const descriptionInput = document.getElementById('imageDescription');
    const file = imageInput.files[0];
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // Store image as base64 and description
            pathPoints[currentPointIndex].image = e.target.result;
            pathPoints[currentPointIndex].description = descriptionInput.value;
            
            // Update point marker style
            const pointMarker = pathPoints[currentPointIndex].marker;
            if (pointMarker) {
                pointMarker.getElement().classList.add('has-image');
                pointMarker.getElement().setAttribute('data-description', descriptionInput.value);
            }
            
            // Close modal
            closeImageModal();
            
            // Update path details
            updatePathDetails();
        };
        reader.readAsDataURL(file);
    } else {
        // If no image, just save description
        pathPoints[currentPointIndex].description = descriptionInput.value;
        closeImageModal();
        updatePathDetails();
    }
}

// Update path details display
function updatePathDetails() {
    const detailsDiv = document.getElementById('pathDetails');
    let details = `<p><strong>Points:</strong> ${pathPoints.length}</p>`;
    
    // Calculate total distance
    const totalDistance = calculatePathDistance(pathPoints.map(p => [p.lat, p.lng]));
    const estimatedTime = Math.ceil(totalDistance * 12); // Assuming 5 km/h walking speed
    
    details += `<p><strong>Distance:</strong> ${totalDistance.toFixed(2)} km</p>`;
    details += `<p><strong>Estimated Time:</strong> ${estimatedTime} minutes</p>`;
    
    // Add image and description information
    pathPoints.forEach((point, index) => {
        details += `<p><strong>Point ${index + 1}:</strong> `;
        if (point.image) {
            details += 'Has image';
        }
        if (point.description) {
            details += ` - ${point.description}`;
        }
        details += '</p>';
    });
    
    detailsDiv.innerHTML = details;
}

// Update the path drawing click handler
pathMap.on('click', function(e) {
    if (!pathLayer) {
        pathPoints = [];
        pathLayer = L.polyline([], {
            color: '#4CAF50',
            weight: 6,
            opacity: 0.9
        }).addTo(pathMap);
    }
    
    // Add point to path with image and description properties
    const point = {
        lat: e.latlng.lat,
        lng: e.latlng.lng,
        image: null,
        description: '',
        marker: L.marker(e.latlng, {
            icon: L.divIcon({
                className: 'path-point',
                html: `<div class="path-point">${pathPoints.length + 1}</div>`,
                iconSize: [24, 24]
            })
        }).addTo(pathMap)
    };
    
    // Add click handler to marker for editing
    point.marker.on('click', function() {
        currentPointIndex = pathPoints.indexOf(point);
        showImageModal(currentPointIndex);
    });
    
    pathPoints.push(point);
    currentPointIndex = pathPoints.length - 1;
    
    // Update path layer
    pathLayer.setLatLngs(pathPoints.map(p => [p.lat, p.lng]));
    
    // Show image upload modal
    showImageModal(currentPointIndex);
    
    // Enable save button if we have at least 2 points
    if (pathPoints.length >= 2) {
        document.getElementById('savePath').disabled = false;
    }
});

// Update the save path function to include images and descriptions
document.getElementById('savePath').addEventListener('click', async function() {
    const pathName = document.getElementById('pathName').value;
    const pathDescription = document.getElementById('pathDescription').value;
    const startDoor = document.getElementById('startDoor').value;
    const hotelId = '6844e2596e4bf672d629e738'; // Use the MongoDB _id directly

    if (!pathName || !startDoor || pathPoints.length < 2 || !hotelId) {
        alert('Please fill in all fields and draw a valid path');
        return;
    }

    try {
        const response = await fetch('http://localhost:5000/api/walking-paths', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: pathName,
                description: pathDescription,
                hotelId: hotelId,
                destination: startDoor,
                coordinates: pathPoints.map(point => ({
                    lat: point.lat,
                    lng: point.lng,
                    image: point.image,
                    description: point.description
                }))
            })
        });

        if (response.ok) {
            alert('Path saved successfully!');
            // Reset path
            pathPoints = [];
            if (pathLayer) {
                pathMap.removeLayer(pathLayer);
                pathLayer = null;
            }
            document.getElementById('savePath').disabled = true;
            document.getElementById('pathDetails').innerHTML = 'Click on the map to start drawing the path.';
        } else {
            throw new Error('Failed to save path');
        }
    } catch (error) {
        console.error('Error saving path:', error);
        alert('Failed to save path. Please try again.');
    }
});
// ... existing code ...
</script>
// ... existing code ...
</body>
</html>